<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFRA / MINT - Collective AI Art Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        body { background: #f2f2f2; color: #000; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f2f2f2; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        
        .glass-light { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .glass-dark { background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); }
        
        .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .text-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .page-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .input-modern { background: #f8f8f8; border: 1px solid #e5e5e5; padding: 14px 16px; font-size: 14px; transition: all 0.2s; }
        .input-modern:focus { outline: none; border-color: #667eea; background: white; }
        
        .input-dark { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 14px 16px; }
        .input-dark:focus { outline: none; border-color: #667eea; }
        .input-dark::placeholder { color: rgba(255,255,255,0.5); }
        
        .btn-primary { background: black; color: white; padding: 14px 28px; font-size: 11px; letter-spacing: 0.2em; font-weight: 700; transition: all 0.3s; }
        .btn-primary:hover { background: #667eea; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-secondary { background: transparent; color: black; padding: 14px 28px; font-size: 11px; letter-spacing: 0.2em; font-weight: 700; border: 2px solid black; transition: all 0.3s; }
        .btn-secondary:hover { background: black; color: white; }
        
        .card-hover { transition: all 0.3s; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        
        .tab-active { border-bottom: 2px solid black; color: black; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #9ca3af; }
        
        .admin-tab-active { background: rgba(239,68,68,0.2); color: #ef4444; border-bottom-color: #ef4444; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#f2f2f2] text-black">

<!-- Navigation -->
<nav id="main-nav" class="fixed top-0 left-0 right-0 z-50 glass-light">
    <div class="max-w-7xl mx-auto px-6 lg:px-12 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('home')">
                <svg width="36" height="36" viewBox="0 0 80 80" fill="none">
                    <defs><linearGradient id="nav-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs>
                    <ellipse cx="40" cy="38" rx="28" ry="32" fill="url(#nav-grad)" opacity="0.15"/>
                    <ellipse cx="34" cy="34" rx="22" ry="26" fill="url(#nav-grad)" opacity="0.25"/>
                    <ellipse cx="42" cy="40" rx="18" ry="22" fill="url(#nav-grad)" opacity="0.45"/>
                    <ellipse cx="40" cy="38" rx="12" ry="15" fill="url(#nav-grad)" opacity="0.85"/>
                </svg>
                <div class="text-lg font-black tracking-tight flex items-center">
                    <span class="text-black">INFRA</span>
                    <span class="text-purple-500 mx-1.5 font-light">/</span>
                    <span class="text-gray-400 font-light">MINT</span>
                </div>
            </div>
            
            <div id="desktop-nav" class="hidden md:flex items-center gap-8">
                <button onclick="showPage('home')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">HOME</button>
                <button onclick="showPage('how')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">HOW IT WORKS</button>
                <button onclick="showPage('gallery')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">GALLERY</button>
                <button onclick="showPage('ethics')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">ETHICS</button>
                <button onclick="showPage('signin')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">SIGN IN</button>
                <button onclick="showPage('signup')" class="bg-black text-white px-6 py-2.5 text-[11px] tracking-[0.2em] font-semibold hover:bg-purple-600 transition-all">GET STARTED</button>
            </div>

            <button onclick="toggleMobileMenu()" class="md:hidden text-black">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <div id="mobile-menu" class="hidden md:hidden pt-4 pb-2 space-y-3 border-t border-gray-200 mt-4">
            <button onclick="showPage('home'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">Home</button>
            <button onclick="showPage('how'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">How It Works</button>
            <button onclick="showPage('gallery'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">Gallery</button>
            <button onclick="showPage('ethics'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">Ethics</button>
            <button onclick="showPage('signin'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">Sign In</button>
            <button onclick="showPage('signup'); toggleMobileMenu()" class="block w-full text-left text-gray-500 hover:text-black text-sm">Get Started</button>
        </div>
    </div>
</nav>

<!-- ==================== HOME PAGE ==================== -->
<div id="page-home" class="page-content pt-16">
    <section class="min-h-screen relative flex flex-col">
        <div class="flex-1 grid grid-cols-12 gap-0 min-h-[calc(100vh-64px)]">
            <div class="col-span-12 lg:col-span-5 flex flex-col justify-center px-6 lg:px-12 py-16 lg:py-0 relative z-20">
                <div>
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-8 h-px bg-purple-500"></div>
                        <span class="text-[10px] tracking-[0.4em] text-gray-400 font-medium">COLLECTIVE ART PLATFORM</span>
                    </div>
                    <div class="space-y-1">
                        <h1 class="text-5xl lg:text-7xl xl:text-8xl font-extralight text-black leading-[0.85] tracking-tight">Where</h1>
                        <h1 class="text-5xl lg:text-7xl xl:text-8xl font-black text-black leading-[0.85] tracking-tighter">THOUSANDS</h1>
                        <h1 class="text-3xl lg:text-4xl xl:text-5xl font-light text-purple-600 leading-[1.1] italic mt-4">Create Together</h1>
                    </div>
                </div>
                <p class="text-gray-500 text-base lg:text-lg leading-relaxed mt-10 max-w-sm font-light">
                    Museum-grade AI art from hundreds of faces. <span class="text-black font-medium">Sold once. Revenue shared with all contributors.</span>
                </p>
                <div class="flex items-center gap-5 mt-10">
                    <button onclick="showPage('signup')" class="group bg-black text-white px-7 py-4 text-[11px] tracking-[0.2em] font-bold hover:bg-purple-600 transition-all flex items-center gap-3">
                        START NOW
                        <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                    </button>
                    <button onclick="showPage('how')" class="text-[11px] tracking-[0.15em] text-gray-400 hover:text-black transition-colors font-medium">HOW IT WORKS</button>
                </div>
                <div class="flex gap-8 mt-16 pt-8 border-t border-gray-300">
                    <div><div class="text-2xl lg:text-3xl font-black text-black">2.8K</div><div class="text-[9px] tracking-[0.2em] text-gray-400 mt-1">CONTRIBUTORS</div></div>
                    <div><div class="text-2xl lg:text-3xl font-black text-black">$45K</div><div class="text-[9px] tracking-[0.2em] text-gray-400 mt-1">PAID OUT</div></div>
                    <div><div class="text-2xl lg:text-3xl font-black text-black">75%</div><div class="text-[9px] tracking-[0.2em] text-gray-400 mt-1">REVENUE SHARE</div></div>
                </div>
            </div>
            <div class="col-span-12 lg:col-span-7 relative overflow-hidden min-h-[400px] lg:min-h-0">
                <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1482160549825-59d1b23cb208?w=1200&q=90');"></div>
                <div class="absolute inset-0 bg-gradient-to-r from-[#f2f2f2] via-[#f2f2f2]/20 to-transparent lg:via-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-[#f2f2f2]/50 via-transparent to-transparent"></div>
                <div class="absolute bottom-8 right-8 bg-black text-white px-5 py-3 shadow-2xl">
                    <div class="text-[10px] tracking-[0.3em] font-medium">FEATURED</div>
                    <div class="text-lg font-black mt-1">$12,500</div>
                </div>
            </div>
        </div>
    </section>

    <section class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="text-center mb-16">
                <span class="text-[10px] tracking-[0.4em] text-gray-400 block mb-4">WHY INFRA / MINT</span>
                <h2 class="text-4xl lg:text-5xl font-black tracking-tighter">ART MADE BY <span class="text-purple-500">THOUSANDS</span></h2>
                <p class="text-gray-500 mt-4">Owned by One</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-8 border border-gray-200 card-hover cursor-pointer">
                    <div class="text-3xl mb-4">üë•</div>
                    <h3 class="text-xl font-black mb-3">Collective Creation</h3>
                    <p class="text-gray-500 leading-relaxed">Hundreds of faces abstracted and woven into a single masterpiece by AI.</p>
                </div>
                <div class="p-8 border border-gray-200 card-hover cursor-pointer">
                    <div class="text-3xl mb-4">üîí</div>
                    <h3 class="text-xl font-black mb-3">One of One</h3>
                    <p class="text-gray-500 leading-relaxed">Each artwork sells once. Once sold, it's locked forever.</p>
                </div>
                <div class="p-8 border border-gray-200 card-hover cursor-pointer">
                    <div class="text-3xl mb-4">üí∞</div>
                    <h3 class="text-xl font-black mb-3">Automatic Revenue</h3>
                    <p class="text-gray-500 leading-relaxed">75% distributed to contributors instantly via Stripe.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="py-24 bg-[#f2f2f2]">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="flex items-end justify-between mb-12">
                <div>
                    <span class="text-[10px] tracking-[0.4em] text-gray-400 block mb-4">OPEN PROJECTS</span>
                    <h2 class="text-4xl font-black tracking-tighter">JOIN A PROJECT</h2>
                </div>
                <button onclick="showPage('contribute')" class="text-[11px] tracking-[0.2em] font-bold flex items-center gap-2 border-b-2 border-black pb-1 hover:border-purple-600 hover:text-purple-600 transition-colors">
                    VIEW ALL <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                </button>
            </div>
            <div id="home-projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="text-center py-12 text-gray-400 col-span-full">Loading projects...</div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== HOW IT WORKS PAGE ==================== -->
<div id="page-how" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="text-center mb-16 lg:mb-24">
                <div class="flex items-center justify-center gap-3 mb-6">
                    <div class="w-12 h-px bg-purple-500"></div>
                    <span class="text-[10px] tracking-[0.4em] text-gray-400 font-medium">THE PROCESS</span>
                    <div class="w-12 h-px bg-purple-500"></div>
                </div>
                <h1 class="text-4xl lg:text-6xl font-black tracking-tighter">HOW IT <span class="text-purple-500">WORKS</span></h1>
                <p class="text-gray-500 text-lg mt-6 max-w-2xl mx-auto">Four simple steps from contribution to earning.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                <div class="bg-[#f8f8f8] p-8 lg:p-12 group hover:bg-[#f0f0f0] transition-all">
                    <div class="flex items-start gap-6">
                        <span class="text-7xl lg:text-8xl font-black text-gray-200 group-hover:text-purple-200 transition-colors leading-none">01</span>
                        <div class="flex-1 pt-4">
                            <h3 class="text-2xl font-black tracking-tight mb-4">CONTRIBUTE YOUR FACE</h3>
                            <p class="text-gray-500 leading-relaxed mb-6">Upload a face-only photo. Our AI transforms it into abstract, non-identifiable artistic elements.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">FACE VALIDATION</span>
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">PRIVACY FIRST</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-[#f8f8f8] p-8 lg:p-12 group hover:bg-[#f0f0f0] transition-all">
                    <div class="flex items-start gap-6">
                        <span class="text-7xl lg:text-8xl font-black text-gray-200 group-hover:text-purple-200 transition-colors leading-none">02</span>
                        <div class="flex-1 pt-4">
                            <h3 class="text-2xl font-black tracking-tight mb-4">AI CREATES THE ARTWORK</h3>
                            <p class="text-gray-500 leading-relaxed mb-6">Hundreds of contributor faces merge into unique Impressionist-style compositions in museum-grade resolution.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">AI GENERATION</span>
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">MUSEUM QUALITY</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-[#f8f8f8] p-8 lg:p-12 group hover:bg-[#f0f0f0] transition-all">
                    <div class="flex items-start gap-6">
                        <span class="text-7xl lg:text-8xl font-black text-gray-200 group-hover:text-purple-200 transition-colors leading-none">03</span>
                        <div class="flex-1 pt-4">
                            <h3 class="text-2xl font-black tracking-tight mb-4">COLLECTOR PURCHASES</h3>
                            <p class="text-gray-500 leading-relaxed mb-6">Each "One of One" artwork sells to a single collector. Once purchased, it's permanently locked.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">ONE OF ONE</span>
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">CERTIFICATE</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-[#f8f8f8] p-8 lg:p-12 group hover:bg-[#f0f0f0] transition-all">
                    <div class="flex items-start gap-6">
                        <span class="text-7xl lg:text-8xl font-black text-gray-200 group-hover:text-purple-200 transition-colors leading-none">04</span>
                        <div class="flex-1 pt-4">
                            <h3 class="text-2xl font-black tracking-tight mb-4">AUTOMATIC REVENUE SHARE</h3>
                            <p class="text-gray-500 leading-relaxed mb-6">75% of the sale is instantly distributed to all contributors via Stripe. No delays.</p>
                            <div class="flex flex-wrap gap-2">
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-purple-100 text-purple-600 font-semibold">75% TO CONTRIBUTORS</span>
                                <span class="text-[10px] tracking-wider px-3 py-1 bg-white text-gray-500">VIA STRIPE</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-16 lg:mt-24 bg-black text-white p-8 lg:p-12">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div>
                        <span class="text-[10px] tracking-[0.4em] text-gray-500">EXAMPLE CALCULATION</span>
                        <h3 class="text-2xl lg:text-3xl font-black mt-4 mb-6">How Much Could You Earn?</h3>
                        <p class="text-gray-400 leading-relaxed">If an artwork sells for $10,000 with 1,000 contributors, each receives an equal share of the 75% pool.</p>
                    </div>
                    <div class="bg-white/10 p-6 lg:p-8">
                        <div class="space-y-4">
                            <div class="flex justify-between items-center pb-4 border-b border-white/10"><span class="text-gray-400">Sale Price</span><span class="text-2xl font-black">$10,000</span></div>
                            <div class="flex justify-between items-center pb-4 border-b border-white/10"><span class="text-gray-400">Contributor Pool (75%)</span><span class="text-xl font-bold text-purple-400">$7,500</span></div>
                            <div class="flex justify-between items-center pb-4 border-b border-white/10"><span class="text-gray-400">Contributors</span><span class="text-xl font-bold">1,000</span></div>
                            <div class="flex justify-between items-center pt-2"><span class="text-white font-semibold">Your Earnings</span><span class="text-3xl font-black text-purple-400">$7.50</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-6 border border-gray-200"><h4 class="font-black mb-3">How many artworks can I be in?</h4><p class="text-sm text-gray-500">Unlimited. Earn from each sale.</p></div>
                <div class="p-6 border border-gray-200"><h4 class="font-black mb-3">Can I withdraw my face?</h4><p class="text-sm text-gray-500">Yes, opt out anytime for future artworks.</p></div>
                <div class="p-6 border border-gray-200"><h4 class="font-black mb-3">When do I get paid?</h4><p class="text-sm text-gray-500">Automatically via Stripe within 24-48 hours.</p></div>
            </div>
        </div>
    </section>
    
    <section class="py-16 bg-black text-white overflow-hidden">
        <div class="flex items-center justify-center gap-8 lg:gap-16 flex-wrap px-6">
            <div class="text-center"><div class="text-4xl mb-2">üì∏</div><div class="text-[10px] tracking-[0.2em] text-gray-500">UPLOAD</div></div>
            <div class="text-purple-500 text-2xl">‚Üí</div>
            <div class="text-center"><div class="text-4xl mb-2">üé®</div><div class="text-[10px] tracking-[0.2em] text-gray-500">AI CREATES</div></div>
            <div class="text-purple-500 text-2xl">‚Üí</div>
            <div class="text-center"><div class="text-4xl mb-2">üñºÔ∏è</div><div class="text-[10px] tracking-[0.2em] text-gray-500">COLLECTOR BUYS</div></div>
            <div class="text-purple-500 text-2xl">‚Üí</div>
            <div class="text-center"><div class="text-4xl mb-2">üí∞</div><div class="text-[10px] tracking-[0.2em] text-gray-500">YOU EARN</div></div>
        </div>
    </section>
</div>

<!-- ==================== CONTRIBUTE PAGE ==================== -->
<div id="page-contribute" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-6xl mx-auto px-6 lg:px-12">
            <div class="text-center mb-12">
                <span class="text-[10px] tracking-[0.4em] text-gray-400 block mb-4">BECOME A CONTRIBUTOR</span>
                <h1 class="text-4xl lg:text-5xl font-black tracking-tighter">START <span class="text-purple-500">CONTRIBUTING</span></h1>
                <p class="text-gray-500 mt-4 max-w-xl mx-auto">Select a project, upload your face, and start earning.</p>
            </div>

            <div class="flex items-center justify-center gap-4 mb-12">
                <div id="step1-indicator" class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-black text-white flex items-center justify-center text-sm font-bold">1</div>
                    <span class="text-sm font-medium hidden sm:inline">Select Project</span>
                </div>
                <div class="w-8 h-px bg-gray-300"></div>
                <div id="step2-indicator" class="flex items-center gap-2 opacity-40">
                    <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-sm font-bold">2</div>
                    <span class="text-sm font-medium hidden sm:inline">Upload Face</span>
                </div>
                <div class="w-8 h-px bg-gray-300"></div>
                <div id="step3-indicator" class="flex items-center gap-2 opacity-40">
                    <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center text-sm font-bold">3</div>
                    <span class="text-sm font-medium hidden sm:inline">Confirm</span>
                </div>
            </div>

            <!-- Step 1: Project Selection -->
            <div id="step1-content" class="space-y-8">
                <div class="bg-[#f8f8f8] p-8">
                    <h3 class="text-xl font-black mb-6">SELECT PROJECTS TO JOIN</h3>
                    <div id="projects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="text-center py-8 text-gray-400 col-span-full">Loading available projects...</div>
                    </div>
                </div>
                <div id="selected-projects-summary" class="hidden bg-purple-50 border border-purple-200 p-6">
                    <div class="flex items-center justify-between">
                        <div><span class="text-[10px] tracking-[0.2em] text-purple-600 font-medium">SELECTED</span><p class="font-black text-lg mt-1"><span id="selected-count">0</span> project(s)</p></div>
                        <button onclick="goToStep2()" class="btn-primary">CONTINUE</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Upload -->
            <div id="step2-content" class="hidden space-y-8">
                <div class="bg-[#f8f8f8] p-8">
                    <h3 class="text-xl font-black mb-6">UPLOAD YOUR FACE PHOTO</h3>
                    <div id="upload-zone" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-purple-500 hover:bg-purple-50/50 transition-all">
                        <input type="file" accept="image/*" id="face-upload" class="hidden" onchange="handleFileUpload(event)">
                        <label for="face-upload" class="cursor-pointer block">
                            <div id="upload-placeholder">
                                <div class="w-16 h-16 mx-auto mb-4 bg-black rounded-xl flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                </div>
                                <div class="text-gray-600 text-lg mb-2">Click to upload or drag and drop</div>
                                <div class="text-sm text-gray-400">Face-only selfie, clear lighting</div>
                            </div>
                            <div id="upload-preview" class="hidden">
                                <img id="preview-image" class="max-h-64 mx-auto rounded-lg mb-4">
                                <div class="text-purple-600 font-semibold">‚úì Photo uploaded</div>
                                <button onclick="resetUpload(event)" class="text-sm text-gray-500 hover:text-black mt-2">Change photo</button>
                            </div>
                        </label>
                    </div>
                    <div id="color-match-section" class="hidden mt-8 p-6 bg-white border border-gray-200">
                        <h4 class="font-bold mb-4">Your dominant colors will be matched to:</h4>
                        <div id="color-match-preview" class="flex gap-4"></div>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button onclick="goToStep1()" class="btn-secondary flex-1">‚Üê BACK</button>
                    <button onclick="goToStep3()" class="btn-primary flex-1" id="continue-to-step3" disabled>CONTINUE ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div id="step3-content" class="hidden space-y-8">
                <div class="bg-[#f8f8f8] p-8">
                    <h3 class="text-xl font-black mb-6">CONFIRM YOUR CONTRIBUTION</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div><img id="confirm-image" class="w-full rounded-lg"></div>
                        <div class="space-y-6">
                            <div><span class="text-[10px] tracking-[0.2em] text-gray-400">CONTRIBUTING TO</span><p id="confirm-projects" class="font-bold text-lg mt-1"></p></div>
                            <div class="p-4 bg-white border border-gray-200">
                                <label class="flex items-start gap-3 cursor-pointer">
                                    <input type="checkbox" id="consent-checkbox" class="mt-1 w-5 h-5 rounded accent-purple-600">
                                    <span class="text-gray-600 text-sm leading-relaxed">I consent to my facial image being transformed into abstract, non-identifiable artistic elements and incorporated into artworks sold on this platform. I understand that I will receive automatic proportional revenue share for each artwork sold that includes my face.</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button onclick="goToStep2()" class="btn-secondary flex-1">‚Üê BACK</button>
                    <button onclick="submitContribution()" class="btn-primary flex-1">SUBMIT CONTRIBUTION</button>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== GALLERY PAGE ==================== -->
<div id="page-gallery" class="page-content hidden pt-16">
    <section class="py-24 bg-[#f2f2f2]">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="mb-12">
                <span class="text-[10px] tracking-[0.4em] text-gray-400 block mb-4">COLLECTION</span>
                <h1 class="text-4xl lg:text-6xl font-black tracking-tighter">GALLERY</h1>
                <p class="text-gray-500 mt-2">Each artwork is one of one. Once sold, it's gone forever.</p>
            </div>
            <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="group cursor-pointer">
                    <div class="relative overflow-hidden bg-white p-2 shadow-lg">
                        <div class="aspect-square bg-cover bg-center transition-transform duration-700 group-hover:scale-105" style="background-image: url('https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=600')"></div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <div><h3 class="font-black tracking-wide">IMPRESSIONS AT DAWN</h3><p class="text-xs text-gray-500">1,247 contributors</p></div>
                        <span class="text-lg font-black">$12,500</span>
                    </div>
                </div>
                <div class="group cursor-pointer">
                    <div class="relative overflow-hidden bg-white p-2 shadow-lg">
                        <div class="aspect-square bg-cover bg-center grayscale" style="background-image: url('https://images.unsplash.com/photo-1547891654-e66ed7ebb968?w=600')"></div>
                        <div class="absolute inset-2 bg-black/60 flex items-center justify-center"><span class="text-white font-black tracking-[0.3em] text-lg">SOLD</span></div>
                    </div>
                    <div class="mt-4"><h3 class="font-black tracking-wide text-gray-400">URBAN SYMPHONY</h3><p class="text-xs text-gray-400">2,134 contributors ¬∑ SOLD</p></div>
                </div>
                <div class="group cursor-pointer">
                    <div class="relative overflow-hidden bg-white p-2 shadow-lg">
                        <div class="aspect-square bg-cover bg-center transition-transform duration-700 group-hover:scale-105" style="background-image: url('https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=600')"></div>
                    </div>
                    <div class="mt-4 flex items-center justify-between">
                        <div><h3 class="font-black tracking-wide">GARDEN OF FACES</h3><p class="text-xs text-gray-500">892 contributors</p></div>
                        <span class="text-lg font-black">$9,500</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== ETHICS PAGE ==================== -->
<div id="page-ethics" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-5xl mx-auto px-6 lg:px-12">
            <div class="text-center mb-16">
                <span class="text-[10px] tracking-[0.4em] text-gray-400 block mb-4">OUR COMMITMENT</span>
                <h1 class="text-4xl lg:text-5xl font-black tracking-tighter">ETHICS & <span class="text-purple-500">TRANSPARENCY</span></h1>
            </div>
            <div class="space-y-6">
                <div class="p-8 border border-gray-200 hover:border-purple-300 transition-colors">
                    <div class="flex items-start gap-6">
                        <div class="text-4xl">üîí</div>
                        <div><h3 class="text-2xl font-black mb-3">Privacy First</h3><p class="text-gray-500 leading-relaxed">All faces are transformed into abstract, non-identifiable elements. We never use facial recognition or sell your data. GDPR compliant.</p></div>
                    </div>
                </div>
                <div class="p-8 border border-gray-200 hover:border-purple-300 transition-colors">
                    <div class="flex items-start gap-6">
                        <div class="text-4xl">üí∞</div>
                        <div><h3 class="text-2xl font-black mb-3">Fair Revenue Share</h3><p class="text-gray-500 leading-relaxed">75% of every sale goes to contributors. Automatic and proportional distribution. Platform keeps 25% for operations.</p></div>
                    </div>
                </div>
                <div class="p-8 border border-gray-200 hover:border-purple-300 transition-colors">
                    <div class="flex items-start gap-6">
                        <div class="text-4xl">üéõÔ∏è</div>
                        <div><h3 class="text-2xl font-black mb-3">Your Control</h3><p class="text-gray-500 leading-relaxed">Opt out anytime. Request data deletion under GDPR rights. You stay in control.</p></div>
                    </div>
                </div>
                <div class="p-8 border border-gray-200 hover:border-purple-300 transition-colors">
                    <div class="flex items-start gap-6">
                        <div class="text-4xl">‚ú®</div>
                        <div><h3 class="text-2xl font-black mb-3">Artistic Integrity</h3><p class="text-gray-500 leading-relaxed">Every artwork is genuinely unique. Once sold, the composition can never be recreated. Buyers receive certificates of authenticity.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== SIGNUP PAGE ==================== -->
<div id="page-signup" class="page-content hidden pt-16">
    <section class="min-h-screen flex items-center justify-center py-24 bg-[#f2f2f2]">
        <div class="max-w-md w-full px-6">
            <div class="text-center mb-10">
                <svg class="w-12 h-12 mx-auto mb-4" viewBox="0 0 80 80" fill="none"><defs><linearGradient id="s-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs><ellipse cx="40" cy="38" rx="28" ry="32" fill="url(#s-grad)" opacity="0.15"/><ellipse cx="34" cy="34" rx="22" ry="26" fill="url(#s-grad)" opacity="0.25"/><ellipse cx="42" cy="40" rx="18" ry="22" fill="url(#s-grad)" opacity="0.45"/><ellipse cx="40" cy="38" rx="12" ry="15" fill="url(#s-grad)" opacity="0.85"/></svg>
                <h1 class="text-3xl font-black tracking-tighter">JOIN INFRA / MINT</h1>
                <p class="text-gray-500 mt-2">Choose how you want to participate</p>
            </div>
            <div class="space-y-4">
                <button onclick="showPage('signup-contributor')" class="w-full p-6 bg-white border-2 border-gray-200 hover:border-purple-500 transition-all text-left group">
                    <div class="flex items-center justify-between">
                        <div><h3 class="font-black text-lg group-hover:text-purple-600 transition-colors">CONTRIBUTOR</h3><p class="text-sm text-gray-500 mt-1">Upload your face, earn from AI art sales</p></div>
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-500 group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                </button>
                <button onclick="showPage('signup-collector')" class="w-full p-6 bg-white border-2 border-gray-200 hover:border-purple-500 transition-all text-left group">
                    <div class="flex items-center justify-between">
                        <div><h3 class="font-black text-lg group-hover:text-purple-600 transition-colors">COLLECTOR</h3><p class="text-sm text-gray-500 mt-1">Purchase unique AI artworks</p></div>
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-500 group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                </button>
            </div>
            <p class="text-center text-gray-500 text-sm mt-8">Already have an account? <button onclick="showPage('signin')" class="text-purple-600 font-semibold hover:underline">Sign In</button></p>
        </div>
    </section>
</div>

<!-- ==================== SIGNUP CONTRIBUTOR ==================== -->
<div id="page-signup-contributor" class="page-content hidden pt-16">
    <section class="min-h-screen flex items-center justify-center py-24 bg-[#f2f2f2]">
        <div class="max-w-md w-full px-6">
            <div class="text-center mb-10">
                <button onclick="showPage('signup')" class="text-sm text-gray-500 hover:text-black mb-4 flex items-center gap-2 mx-auto"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Back</button>
                <h1 class="text-3xl font-black tracking-tighter">BECOME A CONTRIBUTOR</h1>
            </div>
            <form id="contributor-signup-form" class="space-y-4">
                <input type="text" id="contributor-name" placeholder="Full Name" class="input-modern w-full" required>
                <input type="email" id="contributor-email" placeholder="Email Address" class="input-modern w-full" required>
                <input type="password" id="contributor-password" placeholder="Password (min 8 characters)" class="input-modern w-full" required>
                <div class="p-4 bg-white border border-gray-200">
                    <label class="flex items-start gap-3 cursor-pointer">
                        <input type="checkbox" id="contributor-terms" class="mt-1 w-4 h-4 rounded accent-purple-600" required>
                        <span class="text-gray-600 text-sm">I agree to the <button type="button" onclick="showPage('contributor-agreement')" class="text-purple-600 underline">Contributor Agreement</button> and <button type="button" onclick="showPage('privacy')" class="text-purple-600 underline">Privacy Policy</button></span>
                    </label>
                </div>
                <button type="submit" onclick="submitContributorSignup(); return false;" class="btn-primary w-full">CREATE ACCOUNT</button>
            </form>
            <div class="mt-6">
                <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-4 bg-[#f2f2f2] text-gray-500">or continue with</span></div></div>
                <button onclick="signInWithGoogle('contributor')" class="mt-4 w-full p-3 border border-gray-300 bg-white hover:bg-gray-50 transition-colors flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span class="text-sm font-medium">Google</span>
                </button>
            </div>
            <p class="text-center text-gray-500 text-sm mt-8">Already have an account? <button onclick="showPage('signin')" class="text-purple-600 font-semibold hover:underline">Sign In</button></p>
        </div>
    </section>
</div>

<!-- ==================== SIGNUP COLLECTOR ==================== -->
<div id="page-signup-collector" class="page-content hidden pt-16">
    <section class="min-h-screen flex items-center justify-center py-24 bg-[#f2f2f2]">
        <div class="max-w-md w-full px-6">
            <div class="text-center mb-10">
                <button onclick="showPage('signup')" class="text-sm text-gray-500 hover:text-black mb-4 flex items-center gap-2 mx-auto"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Back</button>
                <h1 class="text-3xl font-black tracking-tighter">BECOME A COLLECTOR</h1>
            </div>
            <form id="collector-signup-form" class="space-y-4">
                <input type="text" id="collector-name" placeholder="Full Name" class="input-modern w-full" required>
                <input type="email" id="collector-email" placeholder="Email Address" class="input-modern w-full" required>
                <input type="password" id="collector-password" placeholder="Password (min 8 characters)" class="input-modern w-full" required>
                <div class="p-4 bg-white border border-gray-200">
                    <label class="flex items-start gap-3 cursor-pointer">
                        <input type="checkbox" id="collector-terms" class="mt-1 w-4 h-4 rounded accent-purple-600" required>
                        <span class="text-gray-600 text-sm">I agree to the <button type="button" onclick="showPage('terms')" class="text-purple-600 underline">Terms of Service</button> and <button type="button" onclick="showPage('privacy')" class="text-purple-600 underline">Privacy Policy</button></span>
                    </label>
                </div>
                <button type="submit" onclick="submitCollectorSignup(); return false;" class="btn-primary w-full">CREATE ACCOUNT</button>
            </form>
            <div class="mt-6">
                <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-4 bg-[#f2f2f2] text-gray-500">or continue with</span></div></div>
                <button onclick="signInWithGoogle('collector')" class="mt-4 w-full p-3 border border-gray-300 bg-white hover:bg-gray-50 transition-colors flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span class="text-sm font-medium">Google</span>
                </button>
            </div>
        </div>
    </section>
</div>

<!-- ==================== SIGNIN PAGE ==================== -->
<div id="page-signin" class="page-content hidden pt-16">
    <section class="min-h-screen flex items-center justify-center py-24 bg-[#f2f2f2]">
        <div class="max-w-md w-full px-6">
            <div class="text-center mb-10">
                <svg class="w-12 h-12 mx-auto mb-4" viewBox="0 0 80 80" fill="none"><defs><linearGradient id="si-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs><ellipse cx="40" cy="38" rx="28" ry="32" fill="url(#si-grad)" opacity="0.15"/><ellipse cx="34" cy="34" rx="22" ry="26" fill="url(#si-grad)" opacity="0.25"/><ellipse cx="42" cy="40" rx="18" ry="22" fill="url(#si-grad)" opacity="0.45"/><ellipse cx="40" cy="38" rx="12" ry="15" fill="url(#si-grad)" opacity="0.85"/></svg>
                <h1 class="text-3xl font-black tracking-tighter">WELCOME BACK</h1>
            </div>
            <form id="signin-form" class="space-y-4">
                <input type="email" id="signin-email" placeholder="Email Address" class="input-modern w-full" required>
                <input type="password" id="signin-password" placeholder="Password" class="input-modern w-full" required>
                <button type="submit" onclick="submitSignin(); return false;" class="btn-primary w-full">SIGN IN</button>
            </form>
            <div class="mt-6">
                <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-4 bg-[#f2f2f2] text-gray-500">or continue with</span></div></div>
                <button onclick="signInWithGoogle()" class="mt-4 w-full p-3 border border-gray-300 bg-white hover:bg-gray-50 transition-colors flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span class="text-sm font-medium">Google</span>
                </button>
            </div>
            <p class="text-center text-gray-500 text-sm mt-8">Don't have an account? <button onclick="showPage('signup')" class="text-purple-600 font-semibold hover:underline">Sign Up</button></p>
        </div>
    </section>
</div>

<!-- ==================== VERIFY EMAIL ==================== -->
<div id="page-verify-email" class="page-content hidden pt-16">
    <section class="min-h-screen flex items-center justify-center py-24 bg-[#f2f2f2]">
        <div class="max-w-md w-full px-6 text-center">
            <div class="text-6xl mb-6">üìß</div>
            <h1 class="text-3xl font-black tracking-tighter mb-4">CHECK YOUR EMAIL</h1>
            <p class="text-gray-500 mb-8">We've sent a verification link to your email address.</p>
            <button onclick="resendVerification()" class="btn-secondary">RESEND EMAIL</button>
            <p class="text-sm text-gray-400 mt-6">Already verified? <button onclick="showPage('signin')" class="text-purple-600 hover:underline">Sign In</button></p>
        </div>
    </section>
</div>

<!-- ==================== CONTRIBUTOR DASHBOARD ==================== -->
<div id="page-dashboard-contributor" class="page-content hidden pt-16">
    <section class="py-12 bg-white min-h-screen">
        <div class="max-w-6xl mx-auto px-6 lg:px-12">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-12">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter">Welcome back, <span id="dashboard-name" class="text-purple-600">Contributor</span></h1>
                    <p class="text-gray-500 mt-1">Manage your contributions and track your earnings</p>
                </div>
                <div class="mt-4 md:mt-0 flex gap-3">
                    <button onclick="showPage('contribute')" class="btn-primary">+ NEW CONTRIBUTION</button>
                </div>
            </div>

            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-12">
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black" id="stat-contributions">0</div><div class="text-xs tracking-wider text-gray-400 mt-1">CONTRIBUTIONS</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black" id="stat-artworks">0</div><div class="text-xs tracking-wider text-gray-400 mt-1">IN ARTWORKS</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black text-green-600" id="stat-earnings">$0.00</div><div class="text-xs tracking-wider text-gray-400 mt-1">TOTAL EARNINGS</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black text-yellow-600" id="stat-pending">$0.00</div><div class="text-xs tracking-wider text-gray-400 mt-1">PENDING PAYOUT</div></div>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <div class="space-y-6">
                    <div class="p-6 bg-[#f8f8f8] border border-gray-200">
                        <h3 class="font-black mb-6">PROFILE</h3>
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center text-xl font-bold text-white" id="profile-avatar">?</div>
                            <div><div class="font-bold" id="profile-name">Loading...</div><div class="text-gray-500 text-sm" id="profile-email">Loading...</div></div>
                        </div>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between"><span class="text-gray-500">Type</span><span class="text-purple-600 font-semibold">Contributor</span></div>
                            <div class="flex justify-between"><span class="text-gray-500">Country</span><span id="profile-country">-</span></div>
                            <div class="flex justify-between"><span class="text-gray-500">Joined</span><span id="profile-joined">-</span></div>
                        </div>
                        <button onclick="showPage('edit-profile')" class="w-full mt-6 btn-secondary text-xs">EDIT PROFILE</button>
                    </div>
                    <div class="p-6 bg-[#f8f8f8] border border-gray-200">
                        <h3 class="font-black mb-4">PAYOUT SETTINGS</h3>
                        <div id="payout-status" class="text-center py-6">
                            <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                            </div>
                            <p class="text-gray-500 text-sm mb-4">Set up your payout method</p>
                            <button class="btn-primary text-xs">CONNECT STRIPE</button>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-2 space-y-6">
                    <div class="p-6 bg-[#f8f8f8] border border-gray-200">
                        <h3 class="font-black mb-6">YOUR CONTRIBUTIONS</h3>
                        <div id="contributions-list" class="space-y-4">
                            <div id="contributions-empty" class="text-center py-12">
                                <div class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>
                                <p class="text-gray-500 mb-4">No contributions yet</p>
                                <button onclick="showPage('contribute')" class="btn-primary text-xs">MAKE YOUR FIRST CONTRIBUTION</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-[#f8f8f8] border border-gray-200">
                        <h3 class="font-black mb-6">EARNINGS HISTORY</h3>
                        <div id="earnings-list"><div id="earnings-empty" class="text-center py-8"><p class="text-gray-500">No earnings yet.</p></div></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== COLLECTOR DASHBOARD ==================== -->
<div id="page-dashboard-collector" class="page-content hidden pt-16">
    <section class="py-12 bg-white min-h-screen">
        <div class="max-w-6xl mx-auto px-6 lg:px-12">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-12">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter">Welcome back, <span id="collector-dashboard-name" class="text-purple-600">Collector</span></h1>
                    <p class="text-gray-500 mt-1">Explore and collect unique AI artworks</p>
                </div>
                <button onclick="showPage('gallery')" class="btn-primary mt-4 md:mt-0">BROWSE GALLERY</button>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-12">
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black" id="collector-stat-owned">0</div><div class="text-xs tracking-wider text-gray-400 mt-1">ARTWORKS OWNED</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black" id="collector-stat-spent">$0</div><div class="text-xs tracking-wider text-gray-400 mt-1">TOTAL INVESTED</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black text-purple-600" id="collector-stat-available">0</div><div class="text-xs tracking-wider text-gray-400 mt-1">AVAILABLE</div></div>
                <div class="p-6 bg-[#f8f8f8] border border-gray-200"><div class="text-3xl font-black" id="collector-stat-contributors">0</div><div class="text-xs tracking-wider text-gray-400 mt-1">CONTRIBUTORS SUPPORTED</div></div>
            </div>
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="p-6 bg-[#f8f8f8] border border-gray-200">
                    <h3 class="font-black mb-6">PROFILE</h3>
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center text-xl font-bold text-white" id="collector-profile-avatar">?</div>
                        <div><div class="font-bold" id="collector-profile-name">Loading...</div><div class="text-gray-500 text-sm" id="collector-profile-email">Loading...</div></div>
                    </div>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Type</span><span class="text-purple-600 font-semibold">Collector</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Joined</span><span id="collector-profile-joined">-</span></div>
                    </div>
                    <button onclick="showPage('edit-profile')" class="w-full mt-6 btn-secondary text-xs">EDIT PROFILE</button>
                </div>
                <div class="lg:col-span-2 p-6 bg-[#f8f8f8] border border-gray-200">
                    <h3 class="font-black mb-6">YOUR COLLECTION</h3>
                    <div id="collector-collection" class="text-center py-12">
                        <div class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>
                        <p class="text-gray-500 mb-4">No artworks yet</p>
                        <button onclick="showPage('gallery')" class="btn-primary text-xs">BROWSE GALLERY</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- ==================== EDIT PROFILE ==================== -->
<div id="page-edit-profile" class="page-content hidden pt-16">
    <section class="py-12 bg-white min-h-screen">
        <div class="max-w-2xl mx-auto px-6">
            <button onclick="goToDashboard()" class="text-sm text-gray-500 hover:text-black mb-6 flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Back to Dashboard</button>
            <h1 class="text-3xl font-black tracking-tighter mb-8">EDIT PROFILE</h1>
            <div class="flex gap-6 border-b border-gray-200 mb-8">
                <button onclick="showProfileTab('details')" id="tab-details" class="pb-3 text-sm font-semibold tab-active">Details</button>
                <button onclick="showProfileTab('security')" id="tab-security" class="pb-3 text-sm font-semibold tab-inactive">Security</button>
                <button onclick="showProfileTab('notifications')" id="tab-notifications" class="pb-3 text-sm font-semibold tab-inactive">Notifications</button>
            </div>
            <div id="profile-tab-details" class="space-y-6">
                <div><label class="block text-sm font-semibold mb-2">Full Name</label><input type="text" id="edit-full-name" class="input-modern w-full"></div>
                <div><label class="block text-sm font-semibold mb-2">Email</label><input type="email" id="edit-email" class="input-modern w-full" disabled><p class="text-xs text-gray-400 mt-1">Email cannot be changed</p></div>
                <div><label class="block text-sm font-semibold mb-2">Country</label><input type="text" id="edit-country" class="input-modern w-full"></div>
                <div><label class="block text-sm font-semibold mb-2">Bio</label><textarea id="edit-bio" rows="3" class="input-modern w-full"></textarea></div>
                <button onclick="saveProfile()" class="btn-primary">SAVE CHANGES</button>
            </div>
            <div id="profile-tab-security" class="hidden space-y-6">
                <div><label class="block text-sm font-semibold mb-2">Current Password</label><input type="password" class="input-modern w-full"></div>
                <div><label class="block text-sm font-semibold mb-2">New Password</label><input type="password" class="input-modern w-full"></div>
                <div><label class="block text-sm font-semibold mb-2">Confirm New Password</label><input type="password" class="input-modern w-full"></div>
                <button class="btn-primary">UPDATE PASSWORD</button>
            </div>
            <div id="profile-tab-notifications" class="hidden space-y-4">
                <label class="flex items-center gap-3 p-4 bg-[#f8f8f8] border border-gray-200 cursor-pointer"><input type="checkbox" checked class="w-5 h-5 accent-purple-600"><div><div class="font-semibold">Email Notifications</div><div class="text-sm text-gray-500">Receive updates about contributions and earnings</div></div></label>
                <label class="flex items-center gap-3 p-4 bg-[#f8f8f8] border border-gray-200 cursor-pointer"><input type="checkbox" checked class="w-5 h-5 accent-purple-600"><div><div class="font-semibold">Sale Notifications</div><div class="text-sm text-gray-500">Get notified when artworks are sold</div></div></label>
                <button class="btn-primary">SAVE PREFERENCES</button>
            </div>
        </div>
    </section>
</div>

<!-- ==================== ADMIN PAGE ==================== -->
<div id="page-admin" class="page-content hidden pt-16">
    <section class="py-12 bg-[#0a0a0a] text-white min-h-screen">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <div class="px-3 py-1 bg-red-500/20 text-red-400 text-xs font-bold rounded-full">ADMIN</div>
                        <h1 class="text-3xl font-black">Dashboard</h1>
                    </div>
                    <p class="text-gray-400">Welcome back, admin.</p>
                </div>
                <button onclick="loadAdminData()" class="px-4 py-2 bg-white/10 text-sm hover:bg-white/20 transition-colors">‚Üª Refresh</button>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white/5 p-6 border border-white/10"><div class="text-sm text-gray-400 mb-1">Total Users</div><div class="text-3xl font-bold" id="admin-stat-users">0</div><div class="text-xs text-green-400 mt-1">‚Üë <span id="admin-stat-users-new">0</span> this week</div></div>
                <div class="bg-white/5 p-6 border border-white/10"><div class="text-sm text-gray-400 mb-1">Contributions</div><div class="text-3xl font-bold" id="admin-stat-contributions">0</div><div class="text-xs text-yellow-400 mt-1"><span id="admin-stat-pending">0</span> pending</div></div>
                <div class="bg-white/5 p-6 border border-white/10"><div class="text-sm text-gray-400 mb-1">Artworks</div><div class="text-3xl font-bold" id="admin-stat-artworks">0</div><div class="text-xs text-purple-400 mt-1"><span id="admin-stat-sold">0</span> sold</div></div>
                <div class="bg-white/5 p-6 border border-white/10"><div class="text-sm text-gray-400 mb-1">Revenue</div><div class="text-3xl font-bold text-green-400" id="admin-stat-revenue">$0</div><div class="text-xs text-gray-400 mt-1">Platform: $<span id="admin-stat-platform">0</span></div></div>
            </div>

            <div class="flex gap-2 mb-6 border-b border-white/10 overflow-x-auto">
                <button onclick="showAdminTab('overview')" id="admin-tab-overview" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-purple-500 text-white whitespace-nowrap">Overview</button>
                <button onclick="showAdminTab('users')" id="admin-tab-users" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">Users</button>
                <button onclick="showAdminTab('moderation')" id="admin-tab-moderation" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">Photo Moderation</button>
                <button onclick="showAdminTab('artworks')" id="admin-tab-artworks" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">Artworks</button>
                <button onclick="showAdminTab('payments')" id="admin-tab-payments" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">Payments</button>
                <button onclick="showAdminTab('ai-generator')" id="admin-tab-ai-generator" class="admin-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    AI Generator
                </button>
            </div>

            <!-- Overview Tab -->
            <div id="admin-content-overview" class="admin-content">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white/5 p-6 border border-white/10">
                        <h3 class="text-xl font-bold mb-4">Recent Activity</h3>
                        <div id="admin-activity-list" class="space-y-3"><div class="flex items-center gap-3 text-sm"><div class="w-2 h-2 bg-green-500 rounded-full"></div><span class="text-gray-400">No recent activity</span></div></div>
                    </div>
                    <div class="bg-white/5 p-6 border border-white/10">
                        <h3 class="text-xl font-bold mb-4">Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="showAdminTab('moderation')" class="p-4 bg-white/5 hover:bg-white/10 transition-colors text-left"><div class="text-2xl mb-2">üì∑</div><div class="font-medium">Review Photos</div><div class="text-xs text-gray-400"><span id="quick-pending">0</span> pending</div></button>
                            <button onclick="showAdminTab('artworks')" class="p-4 bg-white/5 hover:bg-white/10 transition-colors text-left"><div class="text-2xl mb-2">üé®</div><div class="font-medium">Create Artwork</div><div class="text-xs text-gray-400">Generate new</div></button>
                            <button onclick="showAdminTab('users')" class="p-4 bg-white/5 hover:bg-white/10 transition-colors text-left"><div class="text-2xl mb-2">üë•</div><div class="font-medium">Manage Users</div><div class="text-xs text-gray-400"><span id="quick-users">0</span> total</div></button>
                            <button onclick="showAdminTab('payments')" class="p-4 bg-white/5 hover:bg-white/10 transition-colors text-left"><div class="text-2xl mb-2">üí∞</div><div class="font-medium">View Payments</div><div class="text-xs text-gray-400">Track revenue</div></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="admin-content-users" class="admin-content hidden">
                <div class="bg-white/5 p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold">All Users</h3>
                        <div class="flex gap-3">
                            <input type="text" id="admin-user-search" placeholder="Search users..." class="input-dark px-4 py-2 text-sm" onkeyup="filterAdminUsers()">
                            <select id="admin-user-filter" class="input-dark px-4 py-2 text-sm" onchange="filterAdminUsers()"><option value="all">All Types</option><option value="contributor">Contributors</option><option value="collector">Collectors</option></select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead><tr class="text-left text-sm text-gray-400 border-b border-white/10"><th class="pb-3 font-medium">User</th><th class="pb-3 font-medium">Type</th><th class="pb-3 font-medium">Country</th><th class="pb-3 font-medium">Contributions</th><th class="pb-3 font-medium">Earnings</th><th class="pb-3 font-medium">Joined</th><th class="pb-3 font-medium">Actions</th></tr></thead>
                            <tbody id="admin-users-table" class="text-sm"><tr><td colspan="7" class="py-8 text-center text-gray-400">Loading users...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Moderation Tab -->
            <div id="admin-content-moderation" class="admin-content hidden">
                <div class="bg-white/5 p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold">Photo Moderation Queue</h3>
                        <select id="admin-mod-filter" class="input-dark px-4 py-2 text-sm" onchange="loadModerationQueue()"><option value="pending">Pending Review</option><option value="approved">Approved</option><option value="rejected">Rejected</option><option value="all">All</option></select>
                    </div>
                    <div id="admin-moderation-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <div class="col-span-full text-center py-12 text-gray-400"><div class="text-4xl mb-3">üì∑</div><p>No photos to moderate</p></div>
                    </div>
                </div>
            </div>

            <!-- Artworks Tab -->
            <div id="admin-content-artworks" class="admin-content hidden">
                <div class="bg-white/5 p-6 border border-white/10 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold">Manage Artworks</h3>
                        <button onclick="showCreateArtworkModal()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 text-sm font-semibold">+ Create New Artwork</button>
                    </div>
                    <div class="bg-white/5 p-6 border border-white/10 mb-6">
                        <h4 class="font-bold mb-4">Approved Faces Directory</h4>
                        <div id="approved-faces-directory" class="grid grid-cols-4 md:grid-cols-8 lg:grid-cols-12 gap-2 max-h-64 overflow-y-auto"><div class="col-span-full text-center py-8 text-gray-400">Loading approved faces...</div></div>
                        <div id="selected-faces-count" class="mt-4 text-sm text-gray-400">Selected: <span id="faces-count">0</span> faces</div>
                    </div>
                    <div id="admin-artworks-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="col-span-full text-center py-12 text-gray-400">Loading artworks...</div></div>
                </div>
            </div>

            <!-- Payments Tab -->
            <div id="admin-content-payments" class="admin-content hidden">
                <div class="bg-white/5 p-6 border border-white/10">
                    <h3 class="text-xl font-bold mb-6">Payment History</h3>
                    <div id="admin-payments-list" class="space-y-4"><div class="text-center py-8 text-gray-400">No payments yet</div></div>
                </div>
            </div>

            <!-- AI Generator Tab -->
            <div id="admin-content-ai-generator" class="admin-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-white/5 p-6 border border-white/10">
                        <h3 class="text-xl font-bold mb-6">AI Image Generator</h3>
                        <div class="mb-6">
                            <label class="block text-sm text-gray-400 mb-2">Style Preset</label>
                            <div id="ai-style-grid" class="grid grid-cols-4 gap-2">
                                <button onclick="selectAIStyle('monet')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="monet">üé® Monet</button>
                                <button onclick="selectAIStyle('vangogh')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="vangogh">üåª Van Gogh</button>
                                <button onclick="selectAIStyle('abstract')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="abstract">üî∑ Abstract</button>
                                <button onclick="selectAIStyle('portrait')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="portrait">üë§ Portrait</button>
                                <button onclick="selectAIStyle('landscape')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="landscape">üèûÔ∏è Landscape</button>
                                <button onclick="selectAIStyle('surreal')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="surreal">üåÄ Surreal</button>
                                <button onclick="selectAIStyle('minimal')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="minimal">‚óªÔ∏è Minimal</button>
                                <button onclick="selectAIStyle('custom')" class="ai-style-btn p-3 bg-white/5 hover:bg-white/10 border border-white/10 text-center text-xs" data-style="custom">‚úèÔ∏è Custom</button>
                            </div>
                        </div>
                        <div id="ai-selected-style" class="hidden mb-4 p-3 bg-purple-500/20 border border-purple-500/50 flex items-center justify-between">
                            <span>Selected: <span id="ai-style-name" class="font-bold"></span></span>
                            <button onclick="clearAIStyle()" class="text-xs text-gray-400 hover:text-white">Clear</button>
                        </div>
                        <div id="ai-chat-messages" class="h-64 overflow-y-auto mb-4 space-y-3 hide-scrollbar"></div>
                        <div class="flex gap-2">
                            <input type="text" id="ai-chat-input" placeholder="Describe what you want to generate..." class="input-dark flex-1" onkeypress="if(event.key==='Enter')sendAIMessage()">
                            <button onclick="sendAIMessage()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 font-semibold">Generate</button>
                        </div>
                    </div>
                    <div class="bg-white/5 p-6 border border-white/10">
                        <h3 class="text-xl font-bold mb-6">Generated Image</h3>
                        <div id="ai-generated-container" class="aspect-square bg-white/5 flex items-center justify-center border border-white/10">
                            <div class="text-center text-gray-400"><div class="text-4xl mb-3">üé®</div><p>Generated image will appear here</p></div>
                        </div>
                        <div id="ai-image-actions" class="hidden mt-4 flex gap-3">
                            <button onclick="regenerateAIImage()" class="flex-1 bg-white/10 hover:bg-white/20 py-3 text-sm font-semibold">‚Üª Regenerate</button>
                            <button onclick="downloadAIImage()" class="flex-1 bg-purple-600 hover:bg-purple-700 py-3 text-sm font-semibold">‚Üì Download</button>
                        </div>
                        <div class="mt-6">
                            <h4 class="font-bold mb-3">Recent Generations</h4>
                            <div id="ai-recent-generations" class="grid grid-cols-4 gap-2"><div class="col-span-4 text-center py-4 text-gray-500 text-sm">No recent generations</div></div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 bg-white/5 p-6 border border-white/10">
                    <h3 class="text-xl font-bold mb-4">API Settings</h3>
                    <div class="flex gap-4 items-end">
                        <div class="flex-1"><label class="block text-sm text-gray-400 mb-2">Replicate API Key</label><input type="password" id="replicate-api-key" placeholder="Enter your API key" class="input-dark w-full"></div>
                        <button onclick="saveReplicateKey()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 font-semibold">Save Key</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Create Artwork Modal -->
<div id="create-artwork-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-6">
    <div class="bg-[#1a1a1a] p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-white">Create New Artwork</h3>
            <button onclick="hideCreateArtworkModal()" class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <div class="space-y-4">
            <div><label class="block text-sm text-gray-400 mb-2">Title</label><input type="text" id="artwork-title" class="input-dark w-full" placeholder="Artwork title"></div>
            <div><label class="block text-sm text-gray-400 mb-2">Description</label><textarea id="artwork-description" rows="3" class="input-dark w-full" placeholder="Describe the artwork"></textarea></div>
            <div><label class="block text-sm text-gray-400 mb-2">Price ($)</label><input type="number" id="artwork-price" class="input-dark w-full" placeholder="10000"></div>
            <div><label class="block text-sm text-gray-400 mb-2">Image URL</label><input type="text" id="artwork-image" class="input-dark w-full" placeholder="https://..."></div>
            <div class="text-sm text-gray-400">Selected faces: <span id="modal-faces-count">0</span></div>
            <button onclick="createArtwork()" class="w-full bg-purple-600 hover:bg-purple-700 py-3 font-semibold text-white">Create Artwork</button>
        </div>
    </div>
</div>

<!-- Mosaic Calculator Modal -->
<div id="mosaic-calculator-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-6">
    <div class="bg-[#1a1a1a] p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto text-white">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold">Mosaic Calculator</h3>
            <button onclick="hideMosaicCalculator()" class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <div class="grid lg:grid-cols-2 gap-6">
            <div>
                <div class="mb-6"><label class="block text-sm text-gray-400 mb-2">Reference Image</label><div id="mosaic-image-preview" class="aspect-video bg-white/5 flex items-center justify-center border border-white/10"><span class="text-gray-500">No image selected</span></div></div>
                <div id="image-analysis" class="hidden space-y-3 p-4 bg-white/5 border border-white/10">
                    <h4 class="font-bold">Image Analysis</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-gray-400">Complexity:</span> <span id="analysis-complexity">-</span></div>
                        <div><span class="text-gray-400">Color Regions:</span> <span id="analysis-colors">-</span></div>
                        <div><span class="text-gray-400">Detail Level:</span> <span id="analysis-detail">-</span></div>
                        <div><span class="text-gray-400">Recommended:</span> <span id="analysis-recommended">-</span></div>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div><label class="block text-sm text-gray-400 mb-2">Print Size Preset</label>
                    <select id="print-size-preset" class="input-dark w-full" onchange="calculateMosaic()">
                        <option value="small">Small (50√ó50cm) - ~400 faces</option>
                        <option value="medium" selected>Medium (100√ó100cm) - ~1,600 faces</option>
                        <option value="large">Large (150√ó150cm) - ~3,600 faces</option>
                        <option value="xlarge">X-Large (200√ó150cm) - ~6,000 faces</option>
                        <option value="museum">Museum (300√ó200cm) - ~15,000 faces</option>
                        <option value="custom">Custom Size</option>
                    </select>
                </div>
                <div id="custom-size-inputs" class="hidden grid grid-cols-2 gap-4">
                    <div><label class="block text-sm text-gray-400 mb-2">Width (cm)</label><input type="number" id="custom-width" class="input-dark w-full" value="100" onchange="calculateMosaic()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">Height (cm)</label><input type="number" id="custom-height" class="input-dark w-full" value="100" onchange="calculateMosaic()"></div>
                </div>
                <div><label class="block text-sm text-gray-400 mb-2">Quality Preset</label>
                    <select id="quality-preset" class="input-dark w-full" onchange="calculateMosaic()">
                        <option value="standard">Standard (2.5cm tiles, 150 DPI)</option>
                        <option value="high" selected>High (2cm tiles, 200 DPI)</option>
                        <option value="premium">Premium (1.5cm tiles, 250 DPI)</option>
                        <option value="ultra">Ultra (1.5cm tiles, 300 DPI)</option>
                    </select>
                </div>
                <div id="mosaic-results" class="hidden p-4 bg-purple-500/20 border border-purple-500/50 space-y-2">
                    <h4 class="font-bold text-purple-300">Calculation Results</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>Faces needed: <span id="result-faces" class="font-bold">-</span></div>
                        <div>Grid: <span id="result-grid" class="font-bold">-</span></div>
                        <div>Tile size: <span id="result-tile" class="font-bold">-</span></div>
                        <div>Final DPI: <span id="result-dpi" class="font-bold">-</span></div>
                        <div>Est. price: <span id="result-price" class="font-bold text-green-400">-</span></div>
                        <div>Per contributor: <span id="result-payout" class="font-bold text-green-400">-</span></div>
                    </div>
                </div>
                <button onclick="createMosaicProject()" class="w-full bg-purple-600 hover:bg-purple-700 py-3 font-semibold">Create Project with These Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- ==================== TERMS PAGE ==================== -->
<div id="page-terms" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-3xl mx-auto px-6">
            <h1 class="text-4xl font-black tracking-tighter mb-8">TERMS OF SERVICE</h1>
            <div class="prose prose-gray max-w-none">
                <p class="text-gray-500 mb-6">Last updated: January 2026</p>
                <h2 class="text-xl font-black mt-8 mb-4">1. Acceptance of Terms</h2>
                <p class="text-gray-600 mb-4">By accessing and using InfraMint ("the Platform"), you agree to be bound by these Terms of Service.</p>
                <h2 class="text-xl font-black mt-8 mb-4">2. Platform Description</h2>
                <p class="text-gray-600 mb-4">InfraMint is a collective AI art platform where contributors provide facial images that are transformed into abstract artistic elements and combined into unique artworks.</p>
                <h2 class="text-xl font-black mt-8 mb-4">3. User Accounts</h2>
                <p class="text-gray-600 mb-4">You must provide accurate information when creating an account. You are responsible for maintaining the security of your account.</p>
                <h2 class="text-xl font-black mt-8 mb-4">4. Revenue Sharing</h2>
                <p class="text-gray-600 mb-4">Contributors receive 75% of artwork sales, distributed proportionally among all contributors whose faces appear in the sold artwork.</p>
                <h2 class="text-xl font-black mt-8 mb-4">5. Intellectual Property</h2>
                <p class="text-gray-600 mb-4">Final artworks are owned by their purchasers. Contributors retain no ownership rights to the generated artworks but are entitled to revenue share.</p>
            </div>
            <button onclick="showPage('signup')" class="btn-primary mt-8">BACK TO SIGNUP</button>
        </div>
    </section>
</div>

<!-- ==================== PRIVACY PAGE ==================== -->
<div id="page-privacy" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-3xl mx-auto px-6">
            <h1 class="text-4xl font-black tracking-tighter mb-8">PRIVACY POLICY</h1>
            <div class="prose prose-gray max-w-none">
                <p class="text-gray-500 mb-6">Last updated: January 2026</p>
                <h2 class="text-xl font-black mt-8 mb-4">1. Data Collection</h2>
                <p class="text-gray-600 mb-4">We collect facial images you submit, account information (name, email), and payment information for revenue distribution.</p>
                <h2 class="text-xl font-black mt-8 mb-4">2. Data Usage</h2>
                <p class="text-gray-600 mb-4">Facial images are transformed into abstract artistic elements. We never use facial recognition technology or sell your data to third parties.</p>
                <h2 class="text-xl font-black mt-8 mb-4">3. Data Protection</h2>
                <p class="text-gray-600 mb-4">All data is encrypted in transit and at rest. We comply with GDPR and provide data deletion upon request.</p>
                <h2 class="text-xl font-black mt-8 mb-4">4. Your Rights</h2>
                <p class="text-gray-600 mb-4">You can request data access, correction, or deletion at any time by contacting us.</p>
            </div>
            <button onclick="showPage('signup')" class="btn-primary mt-8">BACK TO SIGNUP</button>
        </div>
    </section>
</div>

<!-- ==================== CONTRIBUTOR AGREEMENT ==================== -->
<div id="page-contributor-agreement" class="page-content hidden pt-16">
    <section class="py-24 bg-white">
        <div class="max-w-3xl mx-auto px-6">
            <h1 class="text-4xl font-black tracking-tighter mb-8">CONTRIBUTOR AGREEMENT</h1>
            <div class="prose prose-gray max-w-none">
                <p class="text-gray-500 mb-6">Last updated: January 2026</p>
                <h2 class="text-xl font-black mt-8 mb-4">1. License Grant</h2>
                <p class="text-gray-600 mb-4">By contributing your facial image, you grant InfraMint a non-exclusive license to transform it into abstract artistic elements for use in generated artworks.</p>
                <h2 class="text-xl font-black mt-8 mb-4">2. Privacy Protection</h2>
                <p class="text-gray-600 mb-4">Your facial image will be transformed beyond recognition. The final artwork will not contain identifiable features of your face.</p>
                <h2 class="text-xl font-black mt-8 mb-4">3. Revenue Share</h2>
                <p class="text-gray-600 mb-4">You will receive a proportional share of 75% of the sale price for each artwork sold that includes your contribution.</p>
                <h2 class="text-xl font-black mt-8 mb-4">4. Withdrawal</h2>
                <p class="text-gray-600 mb-4">You may withdraw your contribution at any time. Existing artworks will remain unchanged, but your face will not be used in future artworks.</p>
            </div>
            <button onclick="showPage('signup-contributor')" class="btn-primary mt-8">BACK TO SIGNUP</button>
        </div>
    </section>
</div>

<!-- ==================== FOOTER ==================== -->
<footer class="py-12 lg:py-16 bg-[#0a0a0a] text-white">
    <div class="max-w-7xl mx-auto px-6 lg:px-12">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between pb-10 border-b border-white/10 gap-8">
            <div class="flex items-center gap-4">
                <svg width="36" height="36" viewBox="0 0 80 80" fill="none">
                    <defs><linearGradient id="footer-grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#667eea"/><stop offset="100%" stop-color="#764ba2"/></linearGradient></defs>
                    <ellipse cx="40" cy="38" rx="28" ry="32" fill="url(#footer-grad)" opacity="0.15"/>
                    <ellipse cx="34" cy="34" rx="22" ry="26" fill="url(#footer-grad)" opacity="0.25"/>
                    <ellipse cx="42" cy="40" rx="18" ry="22" fill="url(#footer-grad)" opacity="0.45"/>
                    <ellipse cx="40" cy="38" rx="12" ry="15" fill="url(#footer-grad)" opacity="0.85"/>
                </svg>
                <div class="text-lg font-black tracking-tight flex items-center">
                    <span class="text-white">INFRA</span>
                    <span class="text-purple-500 mx-1.5 font-light">/</span>
                    <span class="text-gray-400 font-light">MINT</span>
                </div>
            </div>
            <div class="flex flex-wrap gap-6 lg:gap-10 text-[11px] tracking-[0.2em] text-gray-500">
                <button onclick="showPage('how')" class="hover:text-white transition-colors">HOW IT WORKS</button>
                <button onclick="showPage('gallery')" class="hover:text-white transition-colors">GALLERY</button>
                <button onclick="showPage('ethics')" class="hover:text-white transition-colors">ETHICS</button>
                <button onclick="showPage('terms')" class="hover:text-white transition-colors">TERMS</button>
                <button onclick="showPage('privacy')" class="hover:text-white transition-colors">PRIVACY</button>
            </div>
        </div>
        <div class="pt-8 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 text-[10px] tracking-[0.2em] text-gray-600">
            <span>¬© 2026 INFRA / MINT ‚Äî ALL RIGHTS RESERVED</span>
            <span>COLLECTIVE AI ART PLATFORM</span>
        </div>
    </div>
</footer>

<script>
    // Initialize Supabase
    const SUPABASE_URL = 'https://vyibnkztkacifahhlxof.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5aWJua3p0a2FjaWZhaGhseG9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MTE0NzcsImV4cCI6MjA4NDQ4NzQ3N30.k0MGtmRKhQGJ9tX2arw7OUQg1y1SUZP3IBuSkq1E5l4';
    
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let uploadedFile = null;
    let currentUser = null;

    // Check if user is logged in on page load
    async function checkAuth() {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (session) {
            currentUser = session.user;
            updateNavForLoggedInUser();
        }
    }

    // Update navigation when user is logged in
    function updateNavForLoggedInUser() {
        const desktopNav = document.getElementById('desktop-nav');
        if (desktopNav && currentUser) {
            supabaseClient
                .from('profiles')
                .select('user_type, full_name, is_admin')
                .eq('id', currentUser.id)
                .single()
                .then(({ data: profile }) => {
                    if (profile) {
                        const dashboardPage = profile.user_type === 'collector' ? 'dashboard-collector' : 'dashboard-contributor';
                        const isAdmin = profile.is_admin === true;
                        
                        let navHTML = `
                            <button onclick="showPage('home')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">HOME</button>
                            <button onclick="showPage('how')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">HOW IT WORKS</button>
                            <button onclick="showPage('gallery')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">GALLERY</button>
                            <button onclick="showPage('${dashboardPage}')" class="text-[11px] tracking-[0.2em] text-gray-400 hover:text-black transition-colors font-medium">DASHBOARD</button>
                        `;
                        
                        if (isAdmin) {
                            navHTML += `
                                <button onclick="showPage('admin'); loadAdminData();" class="text-[11px] tracking-[0.2em] text-red-500 hover:text-red-400 transition-colors font-medium flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    ADMIN
                                </button>
                            `;
                        }
                        
                        navHTML += `
                            <button onclick="signOut()" class="bg-black text-white px-6 py-2.5 text-[11px] tracking-[0.2em] font-semibold hover:bg-purple-600 transition-all">
                                SIGN OUT
                            </button>
                        `;
                        
                        desktopNav.innerHTML = navHTML;
                    }
                });
        }
    }

    // Initialize on page load
    checkAuth();

    // Listen for auth changes
    supabaseClient.auth.onAuthStateChange((event, session) => {
        if (event === 'SIGNED_IN' && session) {
            currentUser = session.user;
            updateNavForLoggedInUser();
        } else if (event === 'SIGNED_OUT') {
            currentUser = null;
            location.reload(); // Refresh to reset nav
        }
    });

    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(page => {
            page.classList.add('hidden');
        });
        document.getElementById('page-' + pageId).classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Load projects when contribute page is shown
        if (pageId === 'contribute') {
            loadProjects();
            resetContributeFlow();
        }
        
        // Load projects on homepage
        if (pageId === 'home') {
            loadHomeProjects();
        }
    }

    function toggleMobileMenu() {
        const menu = document.getElementById('mobile-menu');
        menu.classList.toggle('hidden');
    }

    // ==================== PROJECT SELECTION ====================
    let selectedProjects = [];
    let availableProjects = [];

    async function loadProjects() {
        try {
            const { data: projects, error } = await supabaseClient
                .from('projects')
                .select('*')
                .in('status', ['open', 'filling'])
                .order('created_at', { ascending: false });

            if (error) throw error;

            availableProjects = projects || [];
            renderProjects();

        } catch (error) {
            console.error('Error loading projects:', error);
            document.getElementById('projects-grid').innerHTML = `
                <div class="col-span-full text-center py-12">
                    <p class="text-red-400">Error loading projects. Please refresh.</p>
                </div>
            `;
        }
    }

    function renderProjects() {
        const grid = document.getElementById('projects-grid');
        
        if (!availableProjects || availableProjects.length === 0) {
            grid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="text-4xl mb-4">üé®</div>
                    <p class="text-gray-400 mb-2">No open projects right now</p>
                    <p class="text-sm text-gray-500">Check back soon for new masterpieces!</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = availableProjects.map(project => {
            const percentFilled = Math.round((project.filled_spots / project.total_spots) * 100);
            const spotsLeft = project.total_spots - project.filled_spots;
            const isSelected = selectedProjects.includes(project.id);
            
            return `
                <div class="project-card glass-effect rounded-2xl overflow-hidden cursor-pointer transition-all hover:scale-[1.02] ${isSelected ? 'ring-2 ring-pink-500' : ''}" 
                     onclick="toggleProject('${project.id}')"
                     id="project-${project.id}">
                    <div class="aspect-video relative overflow-hidden">
                        <img src="${project.image_url}" alt="${project.title}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                        
                        <!-- Selected Badge -->
                        <div class="absolute top-3 right-3 ${isSelected ? '' : 'hidden'}" id="selected-badge-${project.id}">
                            <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">‚úì</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="absolute bottom-0 left-0 right-0 p-4">
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white font-medium">${project.filled_spots.toLocaleString()} / ${project.total_spots.toLocaleString()}</span>
                                <span class="${spotsLeft < 500 ? 'text-yellow-400' : 'text-green-400'}">${spotsLeft.toLocaleString()} spots left</span>
                            </div>
                            <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all" style="width: ${percentFilled}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="text-xl font-bold mb-1">${project.title}</h3>
                        <p class="text-gray-400 text-sm mb-2">by ${project.artist}</p>
                        <p class="text-gray-500 text-sm line-clamp-2">${project.description || ''}</p>
                        
                        <!-- Color Palette -->
                        <div class="flex gap-1 mt-3">
                            ${(Array.isArray(project.dominant_colors) ? project.dominant_colors : []).slice(0, 5).map(color => `
                                <div class="w-6 h-6 rounded-full" style="background-color: ${color}" title="${color}"></div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Load projects for homepage (public view)
    async function loadHomeProjects() {
        try {
            const { data: projects, error } = await supabaseClient
                .from('projects')
                .select('*')
                .in('status', ['open', 'filling'])
                .order('created_at', { ascending: false })
                .limit(6);

            if (error) throw error;

            const grid = document.getElementById('home-projects-grid');
            if (!grid) return;

            if (!projects || projects.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-4xl mb-4">üé®</div>
                        <p class="text-gray-400">No open projects right now</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = projects.map(project => {
                const percentFilled = Math.round((project.filled_spots / project.total_spots) * 100);
                const spotsLeft = project.total_spots - project.filled_spots;
                
                return `
                    <div class="glass-effect rounded-2xl overflow-hidden hover-lift cursor-pointer" onclick="showPage('contribute')">
                        <div class="aspect-video relative overflow-hidden">
                            <img src="${project.image_url}" alt="${project.title}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                            
                            <!-- Progress Bar -->
                            <div class="absolute bottom-0 left-0 right-0 p-4">
                                <div class="flex items-center justify-between text-sm mb-2">
                                    <span class="text-white font-medium">${project.filled_spots.toLocaleString()} / ${project.total_spots.toLocaleString()}</span>
                                    <span class="${spotsLeft < 500 ? 'text-yellow-400' : 'text-green-400'}">${spotsLeft.toLocaleString()} spots left</span>
                                </div>
                                <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-pink-500 to-purple-600" style="width: ${percentFilled}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4">
                            <h3 class="text-xl font-bold mb-1">${project.title}</h3>
                            <p class="text-gray-400 text-sm">by ${project.artist}</p>
                        </div>
                    </div>
                `;
            }).join('');

        } catch (error) {
            console.error('Error loading home projects:', error);
        }
    }

    // Load homepage projects on initial page load
    document.addEventListener('DOMContentLoaded', loadHomeProjects);

    function toggleProject(projectId) {
        const index = selectedProjects.indexOf(projectId);
        
        if (index > -1) {
            // Deselect
            selectedProjects.splice(index, 1);
        } else {
            // Select (max 3)
            if (selectedProjects.length >= 3) {
                alert('You can select up to 3 projects. Deselect one first.');
                return;
            }
            selectedProjects.push(projectId);
        }
        
        updateProjectSelection();
    }

    function updateProjectSelection() {
        // Update card styles
        availableProjects.forEach(project => {
            const card = document.getElementById('project-' + project.id);
            const badge = document.getElementById('selected-badge-' + project.id);
            
            if (selectedProjects.includes(project.id)) {
                card.classList.add('ring-2', 'ring-pink-500');
                badge.classList.remove('hidden');
            } else {
                card.classList.remove('ring-2', 'ring-pink-500');
                badge.classList.add('hidden');
            }
        });
        
        // Update summary
        const summary = document.getElementById('selected-projects-summary');
        const countEl = document.getElementById('selected-count');
        const namesEl = document.getElementById('selected-names');
        const continueBtn = document.getElementById('continue-to-upload');
        
        countEl.textContent = selectedProjects.length;
        
        if (selectedProjects.length > 0) {
            summary.classList.remove('hidden');
            const names = selectedProjects.map(id => {
                const p = availableProjects.find(proj => proj.id === id);
                return p ? p.title : '';
            }).join(', ');
            namesEl.textContent = names;
            continueBtn.disabled = false;
        } else {
            summary.classList.add('hidden');
            namesEl.textContent = 'None selected';
            continueBtn.disabled = true;
        }
    }

    // ==================== STEP NAVIGATION ====================
    function goToStep1() {
        document.getElementById('contribute-step-1').classList.remove('hidden');
        document.getElementById('contribute-step-2').classList.add('hidden');
        document.getElementById('contribute-step-3').classList.add('hidden');
        updateStepIndicators(1);
    }

    function goToStep2() {
        if (selectedProjects.length === 0) {
            alert('Please select at least one project');
            return;
        }
        document.getElementById('contribute-step-1').classList.add('hidden');
        document.getElementById('contribute-step-2').classList.remove('hidden');
        document.getElementById('contribute-step-3').classList.add('hidden');
        updateStepIndicators(2);
        updateColorMatchPreview();
    }

    function goToStep3() {
        if (!uploadedFile) {
            alert('Please upload a photo first');
            return;
        }
        document.getElementById('contribute-step-1').classList.add('hidden');
        document.getElementById('contribute-step-2').classList.add('hidden');
        document.getElementById('contribute-step-3').classList.remove('hidden');
        updateStepIndicators(3);
        prepareConfirmation();
    }

    function updateStepIndicators(currentStep) {
        for (let i = 1; i <= 3; i++) {
            const indicator = document.getElementById('step-' + i + '-indicator');
            if (i <= currentStep) {
                indicator.classList.remove('opacity-50');
                indicator.querySelector('div').classList.remove('bg-gray-700');
                indicator.querySelector('div').classList.add('bg-gradient-to-r', 'from-pink-500', 'to-purple-600');
            } else {
                indicator.classList.add('opacity-50');
                indicator.querySelector('div').classList.add('bg-gray-700');
                indicator.querySelector('div').classList.remove('bg-gradient-to-r', 'from-pink-500', 'to-purple-600');
            }
        }
    }

    function updateColorMatchPreview() {
        const preview = document.getElementById('color-match-preview');
        
        if (!uploadedFile) {
            preview.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <p>Upload a photo to see your potential placement</p>
                </div>
            `;
            return;
        }
        
        // Show selected projects with placeholder matching
        preview.innerHTML = selectedProjects.map(id => {
            const project = availableProjects.find(p => p.id === id);
            if (!project) return '';
            
            const colors = Array.isArray(project.dominant_colors) ? project.dominant_colors : [];
            const randomColor = colors[Math.floor(Math.random() * colors.length)] || '#ffffff';
            
            return `
                <div class="flex items-center gap-4 p-3 bg-white/5 rounded-xl">
                    <img src="${project.image_url}" class="w-16 h-16 rounded-lg object-cover">
                    <div class="flex-1">
                        <div class="font-medium">${project.title}</div>
                        <div class="text-sm text-gray-400">Great match for the ${getColorName(randomColor)} areas!</div>
                    </div>
                    <div class="w-8 h-8 rounded-full" style="background: ${randomColor}"></div>
                </div>
            `;
        }).join('');
    }

    function getColorName(hex) {
        const colors = {
            '#1a237e': 'deep blue', '#283593': 'navy', '#ffd54f': 'golden', '#fff59d': 'light yellow',
            '#1b5e20': 'forest green', '#1565c0': 'ocean blue', '#e3f2fd': 'sky', '#4e342e': 'brown',
            '#d7ccc8': 'beige', '#80cbc4': 'teal', '#ffccbc': 'peach', '#a1887f': 'taupe',
            '#4caf50': 'green', '#81c784': 'light green', '#e1bee7': 'lavender', '#f8bbd9': 'pink'
        };
        return colors[hex] || 'colorful';
    }

    function prepareConfirmation() {
        // Set confirmation photo
        document.getElementById('confirm-photo').src = document.getElementById('preview-image').src;
        
        // Set confirmation projects
        const projectsDiv = document.getElementById('confirm-projects');
        projectsDiv.innerHTML = selectedProjects.map(id => {
            const project = availableProjects.find(p => p.id === id);
            if (!project) return '';
            
            return `
                <div class="flex items-center gap-3 p-2 bg-white/5 rounded-lg">
                    <img src="${project.image_url}" class="w-10 h-10 rounded object-cover">
                    <span class="font-medium">${project.title}</span>
                </div>
            `;
        }).join('');
    }

    function resetContributeFlow() {
        selectedProjects = [];
        uploadedFile = null;
        document.getElementById('contribute-step-1').classList.remove('hidden');
        document.getElementById('contribute-step-2').classList.add('hidden');
        document.getElementById('contribute-step-3').classList.add('hidden');
        document.getElementById('selected-projects-summary').classList.add('hidden');
        document.getElementById('upload-placeholder').classList.remove('hidden');
        document.getElementById('upload-preview').classList.add('hidden');
        document.getElementById('consent-checkbox').checked = false;
        document.getElementById('continue-to-upload').disabled = true;
        document.getElementById('continue-to-confirm').disabled = true;
        updateStepIndicators(1);
    }

    function resetUpload(event) {
        event.preventDefault();
        event.stopPropagation();
        uploadedFile = null;
        document.getElementById('upload-placeholder').classList.remove('hidden');
        document.getElementById('upload-preview').classList.add('hidden');
        document.getElementById('face-upload').value = '';
        document.getElementById('continue-to-confirm').disabled = true;
    }

    // Handle file upload via input
    function handleFileUpload(event) {
        const file = event.target.files[0];
        processUploadedFile(file);
    }

    // Process the uploaded file
    function processUploadedFile(file) {
        if (file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file (JPG, PNG, etc.)');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File is too large. Maximum size is 10MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('upload-placeholder').classList.add('hidden');
                document.getElementById('upload-preview').classList.remove('hidden');
                document.getElementById('preview-image').src = e.target.result;
                uploadedFile = file;
                console.log('File ready for upload:', file.name, file.size);
                
                // Enable continue button
                document.getElementById('continue-to-confirm').disabled = false;
                
                // Update color match preview
                updateColorMatchPreview();
            };
            reader.readAsDataURL(file);
        }
    }

    // Setup drag and drop
    function setupDragAndDrop() {
        const uploadZone = document.getElementById('upload-zone');
        if (!uploadZone) return;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.add('bg-purple-500/20');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.remove('bg-purple-500/20');
            }, false);
        });

        uploadZone.addEventListener('drop', (e) => {
            const file = e.dataTransfer.files[0];
            processUploadedFile(file);
        }, false);
    }

    // Initialize drag and drop when page loads
    document.addEventListener('DOMContentLoaded', setupDragAndDrop);

    // Convert file to base64
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                // Remove the data:image/xxx;base64, prefix
                const base64 = reader.result.split(',')[1];
                resolve(base64);
            };
            reader.onerror = error => reject(error);
        });
    }

    // Call the moderation Edge Function
    async function moderateImage(imageBase64) {
        const response = await fetch(
            'https://vyibnkztkacifahhlxof.supabase.co/functions/v1/moderate-image',
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${(await supabaseClient.auth.getSession()).data.session?.access_token}`
                },
                body: JSON.stringify({ imageBase64 })
            }
        );
        return response.json();
    }

    async function submitContribution() {
        if (!currentUser) {
            alert('Please sign in to contribute');
            showPage('signin');
            return;
        }

        const consent = document.getElementById('consent-checkbox').checked;
        
        if (!uploadedFile) {
            alert('Please upload a photo first');
            return;
        }
        
        if (!consent) {
            alert('Please accept the consent terms');
            return;
        }

        if (selectedProjects.length === 0) {
            alert('Please select at least one project');
            goToStep1();
            return;
        }

        // Show loading state
        const submitBtn = document.getElementById('submit-contribution-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = 'üîç Checking image...';
        submitBtn.disabled = true;

        try {
            // Step 1: AI Moderation Check
            console.log('Starting AI moderation...');
            const imageBase64 = await fileToBase64(uploadedFile);
            const moderationResult = await moderateImage(imageBase64);
            
            console.log('Moderation result:', moderationResult);

            if (!moderationResult.approved) {
                alert('‚ùå ' + moderationResult.reason);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                return;
            }

            // Step 2: Upload file to Supabase Storage (only if moderation passed)
            submitBtn.innerHTML = 'üé® Uploading...';
            
            const fileExt = uploadedFile.name.split('.').pop().toLowerCase();
            const fileName = `${currentUser.id}/${Date.now()}.${fileExt}`;
            
            console.log('Uploading to storage:', fileName);

            const { data: uploadData, error: uploadError } = await supabaseClient.storage
                .from('contributions')
                .upload(fileName, uploadedFile, {
                    cacheControl: '3600',
                    upsert: false
                });

            if (uploadError) {
                console.error('Storage upload error:', uploadError);
                throw uploadError;
            }

            console.log('Upload successful:', uploadData);

            // Create contribution record for the first selected project
            const { data: contribution, error: dbError } = await supabaseClient
                .from('contributions')
                .insert({
                    contributor_id: currentUser.id,
                    image_url: fileName,
                    project_id: selectedProjects[0], // Primary project
                    status: 'pending',
                    consent_given: true
                })
                .select()
                .single();

            if (dbError) {
                console.error('Database error:', dbError);
                throw dbError;
            }

            console.log('Contribution created:', contribution);

            // Increment filled_spots for the primary project
            const primaryProject = availableProjects.find(p => p.id === selectedProjects[0]);
            if (primaryProject) {
                await supabaseClient
                    .from('projects')
                    .update({ filled_spots: primaryProject.filled_spots + 1 })
                    .eq('id', selectedProjects[0]);
            }

            // Link to additional projects if any and increment their spots too
            if (selectedProjects.length > 1) {
                for (let i = 1; i < selectedProjects.length; i++) {
                    await supabaseClient
                        .from('project_contributions')
                        .insert({
                            project_id: selectedProjects[i],
                            contribution_id: contribution.id
                        });
                    
                    // Increment filled_spots for additional projects
                    const additionalProject = availableProjects.find(p => p.id === selectedProjects[i]);
                    if (additionalProject) {
                        await supabaseClient
                            .from('projects')
                            .update({ filled_spots: additionalProject.filled_spots + 1 })
                            .eq('id', selectedProjects[i]);
                    }
                }
            }

            // Get project names for the success message
            const projectNames = selectedProjects.map(id => {
                const p = availableProjects.find(proj => proj.id === id);
                return p ? p.title : '';
            }).join(', ');

            alert(`üéâ Success! Your face has been submitted to: ${projectNames}\n\nYou'll be notified when the artwork is ready!`);
            
            // Reset form and go back to step 1
            resetContributeFlow();

            // Redirect to dashboard
            showPage('dashboard-contributor');

        } catch (error) {
            console.error('Error:', error);
            alert('Error submitting contribution: ' + error.message);
        } finally {
            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }

    // Authentication Functions
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    function validatePassword(password) {
        return password.length >= 8;
    }

    async function submitContributorSignup() {
        const name = document.getElementById('contributor-name').value.trim();
        const email = document.getElementById('contributor-email').value.trim();
        const password = document.getElementById('contributor-password').value;
        const country = document.getElementById('contributor-country').value;
        const terms = document.getElementById('contributor-terms').checked;

        // Validation
        if (!name) {
            alert('Please enter your name');
            return;
        }
        if (!validateEmail(email)) {
            alert('Please enter a valid email address');
            return;
        }
        if (!validatePassword(password)) {
            alert('Password must be at least 8 characters');
            return;
        }
        if (!country) {
            alert('Please select your country');
            return;
        }
        if (!terms) {
            alert('Please accept the terms and conditions');
            return;
        }

        try {
            const { data, error } = await supabaseClient.auth.signUp({
                email: email,
                password: password,
                options: {
                    data: {
                        full_name: name,
                        user_type: 'contributor',
                        country: country
                    },
                    emailRedirectTo: 'https://inframint.io'
                }
            });

            if (error) throw error;

            // Store email for verification page
            document.getElementById('verification-email').textContent = email;
            
            // Show verification page
            showPage('verify-email');

        } catch (error) {
            console.error('Signup error:', error);
            alert('Error signing up: ' + error.message);
        }
    }

    async function submitCollectorSignup() {
        const name = document.getElementById('collector-name').value.trim();
        const email = document.getElementById('collector-email').value.trim();
        const password = document.getElementById('collector-password').value;
        const country = document.getElementById('collector-country').value;
        const terms = document.getElementById('collector-terms').checked;

        // Validation
        if (!name) {
            alert('Please enter your name');
            return;
        }
        if (!validateEmail(email)) {
            alert('Please enter a valid email address');
            return;
        }
        if (!validatePassword(password)) {
            alert('Password must be at least 8 characters');
            return;
        }
        if (!country) {
            alert('Please select your country');
            return;
        }
        if (!terms) {
            alert('Please accept the terms and conditions');
            return;
        }

        try {
            const { data, error } = await supabaseClient.auth.signUp({
                email: email,
                password: password,
                options: {
                    data: {
                        full_name: name,
                        user_type: 'collector',
                        country: country
                    },
                    emailRedirectTo: 'https://inframint.io'
                }
            });

            if (error) throw error;

            // Store email for verification page
            document.getElementById('verification-email').textContent = email;
            
            // Show verification page
            showPage('verify-email');

        } catch (error) {
            console.error('Signup error:', error);
            alert('Error signing up: ' + error.message);
        }
    }

    async function submitSignin() {
        const email = document.getElementById('signin-email').value.trim();
        const password = document.getElementById('signin-password').value;

        if (!validateEmail(email)) {
            alert('Please enter a valid email address');
            return;
        }
        if (!password) {
            alert('Please enter your password');
            return;
        }

        try {
            const { data, error } = await supabaseClient.auth.signInWithPassword({
                email: email,
                password: password
            });

            if (error) throw error;

            currentUser = data.user;
            
            // Load profile and redirect to appropriate dashboard
            await loadUserProfileAndRedirect();

        } catch (error) {
            console.error('Sign in error:', error);
            alert('Error signing in: ' + error.message);
        }
    }

    async function signOut() {
        try {
            const { error } = await supabaseClient.auth.signOut();
            if (error) throw error;
            
            currentUser = null;
            currentProfile = null;
            alert('You have been signed out');
            location.reload();

        } catch (error) {
            console.error('Sign out error:', error);
            alert('Error signing out: ' + error.message);
        }
    }

    async function resendVerification() {
        const email = document.getElementById('verification-email').textContent;
        
        try {
            const { error } = await supabaseClient.auth.resend({
                type: 'signup',
                email: email
            });

            if (error) throw error;
            
            alert('Verification email resent to ' + email);

        } catch (error) {
            console.error('Resend error:', error);
            alert('Error resending email: ' + error.message);
        }
    }

    // Google Sign In
    async function signInWithGoogle(userType) {
        console.log('signInWithGoogle called with:', userType);
        try {
            const { data, error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: 'https://inframint.io',
                    queryParams: {
                        access_type: 'offline',
                        prompt: 'consent'
                    }
                }
            });

            console.log('OAuth response:', data, error);
            if (error) throw error;

        } catch (error) {
            console.error('Google sign in error:', error);
            alert('Error signing in with Google: ' + error.message);
        }
    }

    // Dashboard Functions
    let currentProfile = null;

    async function loadUserProfileAndRedirect() {
        if (!currentUser) return;

        try {
            // First try to get existing profile
            let { data: profile, error } = await supabaseClient
                .from('profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();

            // If no profile exists, create one
            if (error && error.code === 'PGRST116') {
                const { data: newProfile, error: insertError } = await supabaseClient
                    .from('profiles')
                    .insert({
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || '',
                        user_type: currentUser.user_metadata?.user_type || 'contributor',
                        country: currentUser.user_metadata?.country || ''
                    })
                    .select()
                    .single();

                if (insertError) {
                    console.error('Error creating profile:', insertError);
                } else {
                    profile = newProfile;
                }
            }

            if (profile) {
                currentProfile = profile;
                updateNavForLoggedInUser();
                
                // Redirect to appropriate dashboard
                if (profile.user_type === 'collector') {
                    loadCollectorDashboard(profile);
                    showPage('dashboard-collector');
                } else {
                    loadContributorDashboard(profile);
                    showPage('dashboard-contributor');
                }
            }

        } catch (error) {
            console.error('Error loading profile:', error);
        }
    }

    function loadContributorDashboard(profile) {
        // Set profile info
        document.getElementById('dashboard-name').textContent = profile.full_name || 'Contributor';
        document.getElementById('profile-name').textContent = profile.full_name || 'Not set';
        document.getElementById('profile-email').textContent = profile.email;
        document.getElementById('profile-country').textContent = profile.country || '-';
        document.getElementById('profile-joined').textContent = new Date(profile.created_at).toLocaleDateString();
        
        // Set avatar initial
        const initial = (profile.full_name || profile.email || '?')[0].toUpperCase();
        document.getElementById('profile-avatar').textContent = initial;

        // Load stats
        document.getElementById('stat-earnings').textContent = '$' + (profile.total_earnings || 0).toFixed(2);
        
        // Load contributions count
        loadContributorStats(profile.id);
    }

    async function loadContributorStats(userId) {
        try {
            // Get all contributions with project data
            const { data: contributions, error } = await supabaseClient
                .from('contributions')
                .select('*, projects(id, title, image_url, filled_spots, total_spots)')
                .eq('contributor_id', userId)
                .order('created_at', { ascending: false });

            if (!error && contributions) {
                document.getElementById('stat-contributions').textContent = contributions.length;
                
                // Display contributions in the dashboard
                const contributionsList = document.getElementById('contributions-list');
                const emptyState = document.getElementById('contributions-empty');
                
                if (contributions.length > 0) {
                    emptyState.classList.add('hidden');
                    
                    // Create grid of contribution images with project info
                    const contributionsHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${contributions.map(c => {
                                const { data: urlData } = supabaseClient.storage
                                    .from('contributions')
                                    .getPublicUrl(c.image_url);
                                const imageUrl = urlData?.publicUrl || '';
                                const project = c.projects;
                                
                                return `
                                    <div class="glass-effect rounded-xl overflow-hidden">
                                        <div class="flex gap-4 p-4">
                                            <img src="${imageUrl}" 
                                                 alt="My contribution" 
                                                 class="w-20 h-20 rounded-lg object-cover">
                                            <div class="flex-1">
                                                <div class="flex items-center gap-2 mb-1">
                                                    <span class="text-xs px-2 py-1 rounded-full ${
                                                        c.status === 'approved' ? 'bg-green-500/20 text-green-400' : 
                                                        c.status === 'pending' ? 'bg-yellow-500/20 text-yellow-400' : 
                                                        'bg-red-500/20 text-red-400'
                                                    }">${c.status}</span>
                                                    <span class="text-xs text-gray-500">${new Date(c.created_at).toLocaleDateString()}</span>
                                                </div>
                                                ${project ? `
                                                    <div class="flex items-center gap-2 mt-2">
                                                        <img src="${project.image_url}" class="w-8 h-8 rounded object-cover">
                                                        <div>
                                                            <div class="text-sm font-medium">${project.title}</div>
                                                            <div class="text-xs text-gray-400">${project.filled_spots}/${project.total_spots} spots</div>
                                                        </div>
                                                    </div>
                                                ` : '<div class="text-xs text-gray-500 mt-2">No project assigned</div>'}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                    
                    // Insert after the empty state div
                    emptyState.insertAdjacentHTML('afterend', contributionsHTML);
                }
            }

            // Get artworks count (where this contributor's faces are used)
            const { data: artworkContribs } = await supabaseClient
                .from('artwork_contributions')
                .select('artwork_id')
                .eq('contributor_id', userId);

            if (artworkContribs) {
                document.getElementById('stat-artworks').textContent = artworkContribs.length;
            }

        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    function loadCollectorDashboard(profile) {
        // Set profile info
        document.getElementById('collector-dashboard-name').textContent = profile.full_name || 'Collector';
        document.getElementById('collector-profile-name').textContent = profile.full_name || 'Not set';
        document.getElementById('collector-profile-email').textContent = profile.email;
        document.getElementById('collector-profile-country').textContent = profile.country || '-';
        document.getElementById('collector-profile-joined').textContent = new Date(profile.created_at).toLocaleDateString();
        
        // Set avatar initial
        const initial = (profile.full_name || profile.email || '?')[0].toUpperCase();
        document.getElementById('collector-profile-avatar').textContent = initial;

        // Load stats
        document.getElementById('collector-stat-value').textContent = '$' + (profile.total_spent || 0).toFixed(0);
        
        // Load collection count
        loadCollectorStats(profile.id);
    }

    async function loadCollectorStats(userId) {
        try {
            // Get owned artworks count
            const { data: artworks } = await supabaseClient
                .from('artworks')
                .select('id', { count: 'exact' })
                .eq('buyer_id', userId);

            if (artworks) {
                document.getElementById('collector-stat-owned').textContent = artworks.length;
            }

            // Get available artworks count
            const { data: available } = await supabaseClient
                .from('artworks')
                .select('id', { count: 'exact' })
                .eq('status', 'available');

            if (available) {
                document.getElementById('collector-stat-available').textContent = available.length;
            }

        } catch (error) {
            console.error('Error loading collector stats:', error);
        }
    }

    function goToDashboard() {
        if (currentProfile) {
            if (currentProfile.user_type === 'collector') {
                showPage('dashboard-collector');
            } else {
                showPage('dashboard-contributor');
            }
        } else {
            showPage('home');
        }
    }

    async function saveProfile() {
        if (!currentUser) return;

        const name = document.getElementById('edit-name').value.trim();
        const country = document.getElementById('edit-country').value;

        try {
            const { data, error } = await supabaseClient
                .from('profiles')
                .update({
                    full_name: name,
                    country: country,
                    updated_at: new Date().toISOString()
                })
                .eq('id', currentUser.id)
                .select()
                .single();

            if (error) throw error;

            currentProfile = data;
            alert('Profile updated successfully!');
            goToDashboard();

        } catch (error) {
            console.error('Error saving profile:', error);
            alert('Error saving profile: ' + error.message);
        }
    }

    // Load edit profile page
    function loadEditProfile() {
        if (currentProfile) {
            // Personal Info
            document.getElementById('edit-name').value = currentProfile.full_name || '';
            document.getElementById('edit-email').value = currentProfile.email || '';
            document.getElementById('edit-country').value = currentProfile.country || '';
            
            // Avatar and quick info
            const initial = (currentProfile.full_name || currentProfile.email || '?')[0].toUpperCase();
            document.getElementById('profile-page-avatar').textContent = initial;
            document.getElementById('profile-page-name').textContent = currentProfile.full_name || 'Not set';
            document.getElementById('profile-page-email').textContent = currentProfile.email || '';
            document.getElementById('profile-page-type').textContent = currentProfile.user_type === 'collector' ? 'Collector' : 'Contributor';
            document.getElementById('profile-page-joined').textContent = new Date(currentProfile.created_at).toLocaleDateString();
            document.getElementById('profile-page-earned').textContent = '$' + (currentProfile.total_earnings || 0).toFixed(2);
            
            // Load contribution stats
            loadProfileStats();
            
            // Earnings tab
            document.getElementById('earnings-total').textContent = '$' + (currentProfile.total_earnings || 0).toFixed(2);
        }
    }

    async function loadProfileStats() {
        if (!currentUser) return;
        
        try {
            // Get contributions count
            const { data: contributions } = await supabaseClient
                .from('contributions')
                .select('*')
                .eq('contributor_id', currentUser.id);
            
            if (contributions) {
                document.getElementById('profile-page-contributions').textContent = contributions.length;
                
                // Show contributions in grid if any exist
                if (contributions.length > 0) {
                    document.getElementById('profile-contributions-empty').classList.add('hidden');
                    const grid = document.getElementById('profile-contributions-grid');
                    grid.classList.remove('hidden');
                    
                    // Build HTML with actual images
                    const cards = contributions.map(c => {
                        const { data: urlData } = supabaseClient.storage
                            .from('contributions')
                            .getPublicUrl(c.image_url);
                        const imageUrl = urlData?.publicUrl || '';
                        
                        return `
                            <div class="aspect-square rounded-xl bg-gray-800 overflow-hidden relative group">
                                <img src="${imageUrl}" 
                                     alt="My contribution" 
                                     class="w-full h-full object-cover"
                                     onerror="this.style.display='none';">
                                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent">
                                    <div class="text-xs text-gray-400">${new Date(c.created_at).toLocaleDateString()}</div>
                                    <div class="text-xs capitalize ${c.status === 'approved' ? 'text-green-400' : c.status === 'pending' ? 'text-yellow-400' : 'text-red-400'}">${c.status}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    grid.innerHTML = cards.join('');
                }
            }
            
            // Get artwork contributions count
            const { data: artworkContribs } = await supabaseClient
                .from('artwork_contributions')
                .select('artwork_id')
                .eq('contributor_id', currentUser.id);
            
            if (artworkContribs) {
                document.getElementById('profile-page-artworks').textContent = artworkContribs.length;
            }
            
        } catch (error) {
            console.error('Error loading profile stats:', error);
        }
    }

    // Profile tab switching
    function showProfileTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll('.profile-tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // Show selected tab content
        document.getElementById('profile-tab-' + tabName).classList.remove('hidden');
        
        // Update tab button styles
        document.querySelectorAll('.profile-tab').forEach(tab => {
            tab.classList.remove('border-pink-500', 'text-white');
            tab.classList.add('border-transparent', 'text-gray-400');
        });
        
        // Activate selected tab button
        const activeTab = document.getElementById('tab-' + tabName);
        if (activeTab) {
            activeTab.classList.remove('border-transparent', 'text-gray-400');
            activeTab.classList.add('border-pink-500', 'text-white');
        }
    }

    // Override showPage to load data for certain pages
    const originalShowPage = showPage;
    showPage = function(pageId) {
        if (pageId === 'edit-profile') {
            loadEditProfile();
        }
        if (pageId === 'admin') {
            loadAdminData();
        }
        originalShowPage(pageId);
    };

    // ==================== ADMIN FUNCTIONS ====================

    // Admin tab switching
    function showAdminTab(tabName) {
        // Hide all admin tab contents
        document.querySelectorAll('.admin-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // Show selected tab content
        const targetContent = document.getElementById('admin-content-' + tabName);
        if (targetContent) {
            targetContent.classList.remove('hidden');
        }
        
        // Update tab button styles
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.classList.remove('border-pink-500', 'text-white');
            tab.classList.add('border-transparent', 'text-gray-400');
        });
        
        // Activate selected tab button
        const activeTab = document.getElementById('admin-tab-' + tabName);
        if (activeTab) {
            activeTab.classList.remove('border-transparent', 'text-gray-400');
            activeTab.classList.add('border-pink-500', 'text-white');
        }

        // Load tab-specific data
        if (tabName === 'users') loadAdminUsers();
        if (tabName === 'moderation') loadModerationQueue();
        if (tabName === 'artworks') loadAdminArtworks();
        if (tabName === 'payments') loadAdminPayments();
        if (tabName === 'ai-generator') initAIGenerator();
    }

    async function loadAdminData() {
        try {
            // Get user count
            const { data: users } = await supabaseClient
                .from('profiles')
                .select('*');
            
            if (users) {
                document.getElementById('admin-stat-users').textContent = users.length;
                document.getElementById('quick-users').textContent = users.length;
            }

            // Get contribution count
            const { data: contributions } = await supabaseClient
                .from('contributions')
                .select('*');
            
            document.getElementById('admin-stat-contributions').textContent = contributions?.length || 0;

            // Get pending contributions
            const { data: pending } = await supabaseClient
                .from('contributions')
                .select('*')
                .eq('status', 'pending');
            
            document.getElementById('admin-stat-pending').textContent = pending?.length || 0;
            document.getElementById('quick-pending').textContent = pending?.length || 0;

            // Get artwork count
            const { data: artworks } = await supabaseClient
                .from('artworks')
                .select('*');
            
            document.getElementById('admin-stat-artworks').textContent = artworks?.length || 0;

            // Get sold artworks
            const { data: sold } = await supabaseClient
                .from('artworks')
                .select('*')
                .eq('status', 'sold');
            
            document.getElementById('admin-stat-sold').textContent = sold?.length || 0;

            // Calculate revenue
            let totalRevenue = 0;
            if (sold) {
                totalRevenue = sold.reduce((sum, a) => sum + (parseFloat(a.price) || 0), 0);
            }
            document.getElementById('admin-stat-revenue').textContent = '$' + totalRevenue.toLocaleString();
            document.getElementById('admin-stat-platform').textContent = (totalRevenue * 0.25).toLocaleString();

        } catch (error) {
            console.error('Error loading admin data:', error);
        }
    }

    async function loadAdminUsers() {
        try {
            const { data: users } = await supabaseClient
                .from('profiles')
                .select('*')
                .order('created_at', { ascending: false });
            
            const tbody = document.getElementById('admin-users-table');
            
            if (!users || users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="py-8 text-center text-gray-400">No users found</td></tr>';
                return;
            }

            tbody.innerHTML = users.map(user => `
                <tr class="border-b border-gray-800 hover:bg-white/5">
                    <td class="py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-xs font-bold">
                                ${(user.full_name || user.email || '?')[0].toUpperCase()}
                            </div>
                            <div>
                                <div class="font-medium">${user.full_name || 'Not set'}</div>
                                <div class="text-xs text-gray-400">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${user.user_type === 'contributor' ? 'bg-pink-500/20 text-pink-400' : 'bg-purple-500/20 text-purple-400'}">
                            ${user.user_type || 'contributor'}
                        </span>
                        ${user.is_admin ? '<span class="ml-1 px-2 py-1 text-xs rounded-full bg-red-500/20 text-red-400">Admin</span>' : ''}
                    </td>
                    <td class="py-4 text-gray-400">${user.country || '-'}</td>
                    <td class="py-4">0</td>
                    <td class="py-4 text-green-400">$${(user.total_earnings || 0).toFixed(2)}</td>
                    <td class="py-4 text-gray-400">${new Date(user.created_at).toLocaleDateString()}</td>
                    <td class="py-4">
                        <button class="text-gray-400 hover:text-white text-sm">View</button>
                    </td>
                </tr>
            `).join('');

        } catch (error) {
            console.error('Error loading users:', error);
        }
    }

    async function loadModerationQueue() {
        try {
            const filter = document.getElementById('admin-mod-filter')?.value || 'pending';
            
            let query = supabaseClient.from('contributions').select('*, profiles(email, full_name)');
            
            if (filter !== 'all') {
                query = query.eq('status', filter);
            }
            
            const { data: contributions, error } = await query.order('created_at', { ascending: false });
            
            if (error) {
                console.error('Error fetching contributions:', error);
            }

            console.log('Contributions:', contributions);
            
            const grid = document.getElementById('admin-moderation-grid');
            
            if (!contributions || contributions.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-400">
                        <div class="text-4xl mb-3">üì∑</div>
                        <p>No photos to moderate</p>
                        <p class="text-sm">New submissions will appear here</p>
                    </div>
                `;
                return;
            }

            // Build HTML for each contribution with actual image
            const contributionCards = await Promise.all(contributions.map(async (c) => {
                // Get the public URL for the image
                const { data: urlData } = supabaseClient.storage
                    .from('contributions')
                    .getPublicUrl(c.image_url);
                
                const imageUrl = urlData?.publicUrl || '';
                const contributorName = c.profiles?.full_name || c.profiles?.email || 'Unknown';
                
                return `
                    <div class="rounded-xl bg-gray-800 overflow-hidden relative group">
                        <div class="aspect-square relative">
                            <img src="${imageUrl}" 
                                 alt="Contribution" 
                                 class="w-full h-full object-cover"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="absolute inset-0 items-center justify-center bg-gray-800" style="display: none;">
                                <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="p-3">
                            <div class="text-xs text-gray-400 mb-1">${contributorName}</div>
                            <div class="text-xs text-gray-500 mb-2">${new Date(c.created_at).toLocaleDateString()}</div>
                            <div class="flex items-center justify-between">
                                <span class="text-xs capitalize px-2 py-1 rounded-full ${c.status === 'approved' ? 'bg-green-500/20 text-green-400' : c.status === 'pending' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'}">${c.status}</span>
                                ${c.status === 'pending' ? `
                                    <div class="flex gap-1">
                                        <button onclick="approveContribution('${c.id}')" class="p-1.5 bg-green-500 hover:bg-green-600 rounded-lg text-white text-xs" title="Approve">‚úì</button>
                                        <button onclick="rejectContribution('${c.id}')" class="p-1.5 bg-red-500 hover:bg-red-600 rounded-lg text-white text-xs" title="Reject">‚úó</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }));

            grid.innerHTML = contributionCards.join('');

        } catch (error) {
            console.error('Error loading moderation queue:', error);
        }
    }

    async function approveContribution(id) {
        try {
            const { error } = await supabaseClient
                .from('contributions')
                .update({ status: 'approved' })
                .eq('id', id);
            
            if (error) throw error;
            loadModerationQueue();
            loadAdminData();
        } catch (error) {
            alert('Error approving: ' + error.message);
        }
    }

    async function rejectContribution(id) {
        try {
            const { error } = await supabaseClient
                .from('contributions')
                .update({ status: 'rejected' })
                .eq('id', id);
            
            if (error) throw error;
            loadModerationQueue();
            loadAdminData();
        } catch (error) {
            alert('Error rejecting: ' + error.message);
        }
    }

    async function loadAdminArtworks() {
        // First load approved faces directory
        await loadApprovedFacesDirectory();
        
        try {
            const { data: artworks } = await supabaseClient
                .from('artworks')
                .select('*')
                .order('created_at', { ascending: false });
            
            const grid = document.getElementById('admin-artworks-grid');
            
            if (!artworks || artworks.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-400">
                        <div class="text-4xl mb-3">üé®</div>
                        <p>No artworks yet</p>
                        <p class="text-sm">Create your first AI artwork</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = artworks.map(a => `
                <div class="glass-effect rounded-2xl overflow-hidden">
                    <div class="aspect-square bg-gray-800 flex items-center justify-center">
                        ${a.image_url ? `<img src="${a.image_url}" class="w-full h-full object-cover">` : 'üé®'}
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold">${a.title}</h4>
                        <div class="text-sm text-gray-400">${a.contributor_count || 0} contributors</div>
                        <div class="text-lg font-bold gradient-text">$${parseFloat(a.price || 0).toLocaleString()}</div>
                        <div class="text-xs mt-2 ${a.status === 'sold' ? 'text-green-400' : 'text-yellow-400'}">${a.status}</div>
                    </div>
                </div>
            `).join('');

        } catch (error) {
            console.error('Error loading artworks:', error);
        }
    }

    async function loadApprovedFacesDirectory() {
        try {
            const { data: approvedFaces, error } = await supabaseClient
                .from('contributions')
                .select('*, profiles(email, full_name)')
                .eq('status', 'approved')
                .order('created_at', { ascending: false });
            
            const grid = document.getElementById('approved-faces-grid');
            const countEl = document.getElementById('approved-faces-count');
            
            if (error) {
                console.error('Error loading approved faces:', error);
                return;
            }
            
            if (!approvedFaces || approvedFaces.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <p>No approved faces yet</p>
                        <p class="text-xs mt-1">Approve contributions in Photo Moderation</p>
                    </div>
                `;
                countEl.textContent = '0 faces available';
                return;
            }
            
            countEl.textContent = `${approvedFaces.length} faces available`;
            
            grid.innerHTML = approvedFaces.map(face => {
                const { data: urlData } = supabaseClient.storage
                    .from('contributions')
                    .getPublicUrl(face.image_url);
                const imageUrl = urlData?.publicUrl || '';
                const contributorName = face.profiles?.full_name || face.profiles?.email || 'Unknown';
                
                return `
                    <div class="relative aspect-square rounded-lg overflow-hidden cursor-pointer group" 
                         onclick="toggleFaceSelection('${face.id}')" 
                         id="face-${face.id}"
                         title="${contributorName}">
                        <img src="${imageUrl}" 
                             alt="${contributorName}" 
                             class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-pink-500/0 group-hover:bg-pink-500/30 transition-colors flex items-center justify-center">
                            <div class="hidden group-hover:block text-white text-xs font-bold">Select</div>
                        </div>
                        <div class="face-check hidden absolute top-1 right-1 w-5 h-5 bg-pink-500 rounded-full flex items-center justify-center text-white text-xs">‚úì</div>
                    </div>
                `;
            }).join('');
            
        } catch (error) {
            console.error('Error loading approved faces:', error);
        }
    }

    // Track selected faces for artwork creation
    let selectedFaces = [];

    function toggleFaceSelection(faceId) {
        const faceEl = document.getElementById('face-' + faceId);
        const checkEl = faceEl.querySelector('.face-check');
        
        if (selectedFaces.includes(faceId)) {
            // Deselect
            selectedFaces = selectedFaces.filter(id => id !== faceId);
            faceEl.classList.remove('ring-2', 'ring-pink-500');
            checkEl.classList.add('hidden');
        } else {
            // Select
            selectedFaces.push(faceId);
            faceEl.classList.add('ring-2', 'ring-pink-500');
            checkEl.classList.remove('hidden');
        }
        
        console.log('Selected faces:', selectedFaces.length);
    }

    async function loadAdminPayments() {
        try {
            const { data: payments } = await supabaseClient
                .from('payments')
                .select('*')
                .order('created_at', { ascending: false });
            
            const tbody = document.getElementById('admin-payments-table');
            
            if (!payments || payments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="py-8 text-center text-gray-400">No transactions yet</td></tr>';
                return;
            }

            // Calculate totals
            let totalSales = 0;
            let totalPaid = 0;
            
            payments.forEach(p => {
                if (p.payment_type === 'purchase' && p.status === 'completed') {
                    totalSales += parseFloat(p.amount) || 0;
                }
                if (p.payment_type === 'payout' && p.status === 'completed') {
                    totalPaid += parseFloat(p.amount) || 0;
                }
            });
            
            document.getElementById('admin-total-sales').textContent = '$' + totalSales.toLocaleString();
            document.getElementById('admin-paid-out').textContent = '$' + totalPaid.toLocaleString();
            document.getElementById('admin-platform-revenue').textContent = '$' + (totalSales - totalPaid).toLocaleString();

            tbody.innerHTML = payments.map(p => `
                <tr class="border-b border-gray-800">
                    <td class="py-4 text-gray-400">${new Date(p.created_at).toLocaleDateString()}</td>
                    <td class="py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${p.payment_type === 'purchase' ? 'bg-green-500/20 text-green-400' : 'bg-purple-500/20 text-purple-400'}">
                            ${p.payment_type}
                        </span>
                    </td>
                    <td class="py-4">${p.artwork_id || '-'}</td>
                    <td class="py-4">${p.payer_id || '-'}</td>
                    <td class="py-4 font-semibold">$${parseFloat(p.amount || 0).toFixed(2)}</td>
                    <td class="py-4">
                        <span class="text-xs ${p.status === 'completed' ? 'text-green-400' : 'text-yellow-400'}">${p.status}</span>
                    </td>
                </tr>
            `).join('');

        } catch (error) {
            console.error('Error loading payments:', error);
        }
    }

    function showCreateArtworkModal() {
        document.getElementById('create-artwork-modal').classList.remove('hidden');
    }

    function hideCreateArtworkModal() {
        document.getElementById('create-artwork-modal').classList.add('hidden');
    }

    async function createArtwork() {
        const title = document.getElementById('artwork-title').value.trim();
        const description = document.getElementById('artwork-description').value.trim();
        const price = document.getElementById('artwork-price').value;
        const contributors = document.getElementById('artwork-contributors').value;

        if (!title || !price) {
            alert('Please fill in title and price');
            return;
        }

        try {
            const { data, error } = await supabaseClient
                .from('artworks')
                .insert({
                    title: title,
                    description: description,
                    price: parseFloat(price),
                    contributor_count: parseInt(contributors) || 0,
                    status: 'available'
                });

            if (error) throw error;

            alert('Artwork created successfully!');
            hideCreateArtworkModal();
            loadAdminArtworks();

        } catch (error) {
            console.error('Error creating artwork:', error);
            alert('Failed to create artwork: ' + error.message);
        }
    }

    // ==================== AI IMAGE GENERATOR ====================
    
    let selectedAIStyle = null;
    let currentGeneratedImage = null;
    let lastPrompt = null;
    let recentGenerations = [];
    let isGenerating = false;

    const AI_STYLES = {
        'impressionist': {
            name: 'Impressionist',
            prompt: 'painted in impressionist style with visible brushstrokes, soft light, vibrant colors, capturing fleeting moments and atmosphere, artistic interpretation',
            negative: 'photorealistic, sharp lines, flat colors'
        },
        'abstract': {
            name: 'Abstract',
            prompt: 'abstract art style with geometric shapes, bold colors, non-representational forms, expressive composition, modern artistic interpretation',
            negative: 'realistic, figurative, photographic'
        },
        'surrealist': {
            name: 'Surrealist',
            prompt: 'surrealist dreamlike imagery, unexpected juxtapositions, symbolic elements, ethereal atmosphere, imaginative and fantastical',
            negative: 'realistic, mundane, ordinary'
        },
        'japanese': {
            name: 'Japanese Ukiyo-e',
            prompt: 'traditional Japanese woodblock print style, flat areas of color, bold outlines, nature elements, elegant composition, artistic interpretation of ukiyo-e',
            negative: 'photorealistic, western style, 3D rendered'
        },
        'renaissance': {
            name: 'Renaissance',
            prompt: 'renaissance painting style, classical composition, chiaroscuro lighting, rich details, masterful technique, timeless beauty',
            negative: 'modern, abstract, cartoon'
        },
        'modern': {
            name: 'Modern Art',
            prompt: 'contemporary modern art style, bold artistic expression, innovative composition, vibrant or monochromatic palette, conceptual depth',
            negative: 'classical, traditional, photorealistic'
        },
        'watercolor': {
            name: 'Watercolor',
            prompt: 'watercolor painting style, soft washes of color, delicate gradients, flowing pigments, transparent layers, artistic and dreamy',
            negative: 'oil paint, sharp edges, digital art'
        },
        'oil': {
            name: 'Oil Painting',
            prompt: 'oil painting on canvas, rich textures, layered brushwork, luminous colors, classical painting technique, museum quality',
            negative: 'digital art, flat colors, cartoon'
        }
    };

    function initAIGenerator() {
        const savedKey = localStorage.getItem('replicate_api_key');
        if (savedKey) {
            document.getElementById('replicate-api-key').value = savedKey;
        }
        const savedSignature = localStorage.getItem('ai_signature');
        if (savedSignature) {
            document.getElementById('ai-signature').value = savedSignature;
        }
        loadRecentGenerations();
    }

    function selectAIStyle(style) {
        document.querySelectorAll('.ai-style-btn').forEach(btn => {
            btn.classList.remove('bg-pink-500/50', 'ring-2', 'ring-pink-500');
            btn.classList.add('bg-white/10');
        });
        
        const btn = document.querySelector('.ai-style-btn[data-style="' + style + '"]');
        if (btn) {
            btn.classList.remove('bg-white/10');
            btn.classList.add('bg-pink-500/50', 'ring-2', 'ring-pink-500');
        }
        
        selectedAIStyle = style;
        document.getElementById('selected-style-badge').classList.remove('hidden');
        document.getElementById('selected-style-name').textContent = AI_STYLES[style].name;
        
        addAIMessage('Great choice! I will create your artwork in the <strong class="text-pink-400">' + AI_STYLES[style].name + '</strong> style. Now describe what you would like me to paint.');
    }

    function clearAIStyle() {
        document.querySelectorAll('.ai-style-btn').forEach(btn => {
            btn.classList.remove('bg-pink-500/50', 'ring-2', 'ring-pink-500');
            btn.classList.add('bg-white/10');
        });
        selectedAIStyle = null;
        document.getElementById('selected-style-badge').classList.add('hidden');
    }

    function addUserMessage(text) {
        const messagesContainer = document.getElementById('ai-chat-messages');
        const div = document.createElement('div');
        div.textContent = text;
        const safeText = div.innerHTML;
        
        const messageHTML = '<div class="flex gap-3 justify-end"><div class="bg-gradient-to-r from-pink-500/20 to-purple-600/20 border border-pink-500/30 p-4 rounded-2xl rounded-tr-none max-w-[85%]"><p class="text-sm">' + safeText + '</p></div><div class="w-8 h-8 bg-gray-700 rounded-full flex-shrink-0 flex items-center justify-center text-sm">üë§</div></div>';
        messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function addAIMessage(text, isLoading) {
        const messagesContainer = document.getElementById('ai-chat-messages');
        const messageId = 'ai-msg-' + Date.now();
        
        let content = text;
        if (isLoading) {
            content = '<div class="flex items-center gap-2"><div class="animate-spin w-4 h-4 border-2 border-pink-500 border-t-transparent rounded-full"></div><span>' + text + '</span></div>';
        }
        
        const messageHTML = '<div class="flex gap-3" id="' + messageId + '"><div class="w-8 h-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex-shrink-0 flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg></div><div class="glass-effect p-4 rounded-2xl rounded-tl-none max-w-[85%]"><div class="text-sm">' + content + '</div></div></div>';
        messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        return messageId;
    }

    function updateAIMessage(messageId, text) {
        const messageEl = document.getElementById(messageId);
        if (messageEl) {
            const contentEl = messageEl.querySelector('.text-sm');
            if (contentEl) {
                contentEl.innerHTML = text;
            }
        }
    }

    async function sendAIMessage() {
        const input = document.getElementById('ai-chat-input');
        const userMessage = input.value.trim();
        
        if (!userMessage || isGenerating) return;
        
        const apiKey = document.getElementById('replicate-api-key').value.trim();
        if (!apiKey) {
            addAIMessage('‚ö†Ô∏è Please enter your <strong class="text-pink-400">Replicate API key</strong> in the settings panel on the right before generating images. You can get one free at replicate.com');
            return;
        }
        
        addUserMessage(userMessage);
        input.value = '';
        lastPrompt = userMessage;
        
        let fullPrompt = userMessage;
        if (selectedAIStyle && AI_STYLES[selectedAIStyle]) {
            fullPrompt += ', ' + AI_STYLES[selectedAIStyle].prompt;
        }
        fullPrompt += ', highly detailed, professional artwork, museum quality, masterpiece';
        
        const loadingMsgId = addAIMessage('Creating your artwork... This may take 30-60 seconds.', true);
        
        document.getElementById('generation-status').classList.remove('hidden');
        document.getElementById('generation-status-text').textContent = 'Generating...';
        isGenerating = true;
        
        document.getElementById('ai-send-btn').disabled = true;
        document.getElementById('ai-send-btn').classList.add('opacity-50');
        
        try {
            const aspectRatio = document.getElementById('ai-aspect-ratio').value;
            const quality = document.getElementById('ai-quality').value;
            
            // Use Supabase Edge Function to call Replicate API
            const response = await fetch(SUPABASE_URL + '/functions/v1/quick-processor', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
                },
                body: JSON.stringify({
                    prompt: fullPrompt,
                    aspect_ratio: aspectRatio,
                    api_key: apiKey
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'API request failed');
            }
            
            const result = await response.json();
            
            let imageUrl = null;
            if (result.success && result.output) {
                imageUrl = result.output;
            } else {
                throw new Error(result.error || 'No output in response');
            }
            
            if (!imageUrl) {
                throw new Error('No image URL in response');
            }
            
            const signedImageUrl = await addSignatureToImage(imageUrl);
            currentGeneratedImage = signedImageUrl;
            displayGeneratedImage(signedImageUrl);
            
            const styleName = selectedAIStyle ? AI_STYLES[selectedAIStyle].name : 'custom';
            updateAIMessage(loadingMsgId, '‚ú® Your artwork is ready! I created an original piece in the <strong class="text-pink-400">' + styleName + '</strong> style. You can download it or use it as a new project.');
            
            saveToRecentGenerations(signedImageUrl, userMessage);
            
        } catch (error) {
            console.error('Generation error:', error);
            updateAIMessage(loadingMsgId, '‚ùå Sorry, there was an error: <strong class="text-pink-400">' + error.message + '</strong>. Please check your API key and try again.');
        } finally {
            document.getElementById('generation-status').classList.add('hidden');
            isGenerating = false;
            document.getElementById('ai-send-btn').disabled = false;
            document.getElementById('ai-send-btn').classList.remove('opacity-50');
        }
    }

    // Your signature image as base64
    const SIGNATURE_IMAGE = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAQABgADASIAAhEBAxEB/8QAHQABAAEEAwEAAAAAAAAAAAAAAAgBBgcJAgMEAf/EAE0QAQABAwMCBAQDBQQHBgMHBQABAgMEBQYRByEIEjFBE1FhcSIygRQVI0KRUmKhsQkWJDNygpJDU6LB0fAXY5MlNHPCw+HxGCaDhKP/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAMAwEAAhEDEQA/AIZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB//9k=';

    async function addSignatureToImage(imageUrl) {
        return new Promise((resolve) => {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                // Load signature image
                const sigImg = new Image();
                sigImg.onload = () => {
                    // Calculate signature size (about 8% of image width)
                    const sigWidth = Math.floor(img.width * 0.08);
                    const sigHeight = Math.floor(sigWidth * (sigImg.height / sigImg.width));
                    
                    // Position: bottom right with padding
                    const padding = Math.floor(img.width / 50);
                    const x = img.width - sigWidth - padding;
                    const y = img.height - sigHeight - padding;
                    
                    // Draw signature with slight transparency
                    ctx.globalAlpha = 0.7;
                    ctx.drawImage(sigImg, x, y, sigWidth, sigHeight);
                    ctx.globalAlpha = 1.0;
                    
                    resolve(canvas.toDataURL('image/png'));
                };
                
                sigImg.onerror = () => {
                    // Fallback to text signature if image fails
                    const fontSize = Math.max(12, Math.floor(img.width / 60));
                    ctx.font = fontSize + 'px Inter, sans-serif';
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                    ctx.shadowBlur = 4;
                    const padding = Math.floor(img.width / 40);
                    ctx.fillText('¬© Y. Husri', img.width - padding, img.height - padding);
                    resolve(canvas.toDataURL('image/png'));
                };
                
                sigImg.src = SIGNATURE_IMAGE;
            };
            
            img.onerror = () => {
                resolve(imageUrl);
            };
            
            img.src = imageUrl;
        });
    }

    function displayGeneratedImage(imageUrl) {
        const previewContainer = document.getElementById('ai-image-preview');
        previewContainer.innerHTML = '<img src="' + imageUrl + '" alt="Generated Artwork" class="w-full h-full object-contain">';
        document.getElementById('ai-image-actions').classList.remove('hidden');
    }

    async function regenerateAIImage() {
        if (lastPrompt) {
            document.getElementById('ai-chat-input').value = lastPrompt;
            sendAIMessage();
        } else {
            addAIMessage('Please describe what you would like me to create first!');
        }
    }

    function downloadAIImage() {
        if (!currentGeneratedImage) {
            alert('No image to download');
            return;
        }
        
        const link = document.createElement('a');
        link.href = currentGeneratedImage;
        link.download = 'inframint-artwork-' + Date.now() + '.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        addAIMessage('Your artwork has been downloaded! üéâ');
    }

    function saveReplicateKey() {
        const apiKey = document.getElementById('replicate-api-key').value.trim();
        if (apiKey) {
            localStorage.setItem('replicate_api_key', apiKey);
            const signature = document.getElementById('ai-signature').value.trim();
            if (signature) {
                localStorage.setItem('ai_signature', signature);
            }
            addAIMessage('‚úÖ Your API key has been saved. You are ready to create!');
        } else {
            alert('Please enter an API key');
        }
    }

    function saveToRecentGenerations(imageUrl, prompt) {
        recentGenerations.unshift({ imageUrl: imageUrl, prompt: prompt, timestamp: Date.now() });
        if (recentGenerations.length > 9) {
            recentGenerations = recentGenerations.slice(0, 9);
        }
        localStorage.setItem('ai_recent_generations', JSON.stringify(recentGenerations));
        updateRecentGenerationsUI();
    }

    function loadRecentGenerations() {
        const saved = localStorage.getItem('ai_recent_generations');
        if (saved) {
            try {
                recentGenerations = JSON.parse(saved);
                updateRecentGenerationsUI();
            } catch (e) {
                console.error('Failed to load recent generations:', e);
            }
        }
    }

    function updateRecentGenerationsUI() {
        const container = document.getElementById('recent-generations');
        if (!container) return;
        
        if (recentGenerations.length === 0) {
            container.innerHTML = '<div class="aspect-square rounded-lg bg-gray-800/50 flex items-center justify-center text-gray-600 text-xs">Empty</div><div class="aspect-square rounded-lg bg-gray-800/50 flex items-center justify-center text-gray-600 text-xs">Empty</div><div class="aspect-square rounded-lg bg-gray-800/50 flex items-center justify-center text-gray-600 text-xs">Empty</div>';
            return;
        }
        
        let html = '';
        for (let i = 0; i < Math.min(recentGenerations.length, 3); i++) {
            html += '<div class="aspect-square rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-pink-500 transition-all" onclick="loadRecentGeneration(' + i + ')"><img src="' + recentGenerations[i].imageUrl + '" alt="Recent generation" class="w-full h-full object-cover"></div>';
        }
        for (let i = recentGenerations.length; i < 3; i++) {
            html += '<div class="aspect-square rounded-lg bg-gray-800/50 flex items-center justify-center text-gray-600 text-xs">Empty</div>';
        }
        container.innerHTML = html;
    }

    function loadRecentGeneration(index) {
        const gen = recentGenerations[index];
        if (gen) {
            currentGeneratedImage = gen.imageUrl;
            displayGeneratedImage(gen.imageUrl);
            addAIMessage('Loaded your previous artwork. Original prompt: "' + gen.prompt + '"');
        }
    }

    // ========== MOSAIC CALCULATOR FUNCTIONS ==========
    
    let mosaicSettings = {
        quality: 'hd',
        tileSize: 2, // cm
        printWidth: 150,
        printHeight: 100,
        imageComplexity: 0,
        colorRegions: 0,
        detailLevel: 0
    };
    
    const PRINT_PRESETS = {
        small: { width: 50, height: 50, name: 'Small', viewDistance: '1m' },
        medium: { width: 100, height: 100, name: 'Medium', viewDistance: '1.5m' },
        large: { width: 150, height: 100, name: 'Large', viewDistance: '2m' },
        xlarge: { width: 200, height: 120, name: 'XL', viewDistance: '2.5m' },
        museum: { width: 300, height: 200, name: 'Museum', viewDistance: '3m+' }
    };
    
    const QUALITY_PRESETS = {
        standard: { tileSize: 2.5, dpi: 150, name: 'Standard' },
        hd: { tileSize: 2.0, dpi: 200, name: 'HD' },
        ultra: { tileSize: 1.5, dpi: 300, name: 'Ultra HD' }
    };
    
    function showMosaicCalculator() {
        if (!currentGeneratedImage) {
            alert('Please generate an image first');
            return;
        }
        
        document.getElementById('mosaic-calculator-panel').classList.remove('hidden');
        
        // Analyze the image
        analyzeImage(currentGeneratedImage);
        
        // Calculate initial values
        calculateMosaic();
    }
    
    function hideMosaicCalculator() {
        document.getElementById('mosaic-calculator-panel').classList.add('hidden');
    }
    
    function analyzeImage(imageUrl) {
        // Create canvas to analyze image
        const img = new Image();
        img.crossOrigin = 'anonymous';
        
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Sample at lower resolution for speed
            const sampleSize = 100;
            canvas.width = sampleSize;
            canvas.height = sampleSize;
            ctx.drawImage(img, 0, 0, sampleSize, sampleSize);
            
            const imageData = ctx.getImageData(0, 0, sampleSize, sampleSize);
            const data = imageData.data;
            
            // Analyze color variance (complexity)
            let colorSet = new Set();
            let totalVariance = 0;
            let prevR = 0, prevG = 0, prevB = 0;
            
            for (let i = 0; i < data.length; i += 4) {
                const r = Math.floor(data[i] / 32);     // Quantize to 8 levels
                const g = Math.floor(data[i+1] / 32);
                const b = Math.floor(data[i+2] / 32);
                
                colorSet.add(r + ',' + g + ',' + b);
                
                // Calculate local variance (edge detection proxy)
                if (i > 0) {
                    totalVariance += Math.abs(data[i] - prevR) + Math.abs(data[i+1] - prevG) + Math.abs(data[i+2] - prevB);
                }
                prevR = data[i];
                prevG = data[i+1];
                prevB = data[i+2];
            }
            
            // Normalize scores
            const numColors = colorSet.size;
            const avgVariance = totalVariance / (data.length / 4);
            
            // Map to ratings
            let complexity, colorRegions, detailLevel;
            
            if (avgVariance > 80) {
                complexity = 'High';
                detailLevel = 'Fine';
            } else if (avgVariance > 40) {
                complexity = 'Medium';
                detailLevel = 'Medium';
            } else {
                complexity = 'Low';
                detailLevel = 'Coarse';
            }
            
            if (numColors > 400) {
                colorRegions = '50+';
            } else if (numColors > 200) {
                colorRegions = '25-50';
            } else if (numColors > 100) {
                colorRegions = '10-25';
            } else {
                colorRegions = '<10';
            }
            
            // Update UI
            document.getElementById('analysis-complexity').textContent = complexity;
            document.getElementById('analysis-colors').textContent = colorRegions;
            document.getElementById('analysis-detail').textContent = detailLevel;
            
            // Store for calculations
            mosaicSettings.imageComplexity = avgVariance;
            mosaicSettings.colorRegions = numColors;
            mosaicSettings.detailLevel = avgVariance;
            
            // Recalculate with analysis data
            calculateMosaic();
        };
        
        img.src = imageUrl;
    }
    
    function setMosaicQuality(quality) {
        mosaicSettings.quality = quality;
        mosaicSettings.tileSize = QUALITY_PRESETS[quality].tileSize;
        
        // Update UI
        document.querySelectorAll('.mosaic-quality-btn').forEach(btn => {
            btn.classList.remove('bg-pink-500/30', 'ring-2', 'ring-pink-500');
            btn.classList.add('bg-white/10');
        });
        document.getElementById('quality-' + quality).classList.remove('bg-white/10');
        document.getElementById('quality-' + quality).classList.add('bg-pink-500/30', 'ring-2', 'ring-pink-500');
        
        calculateMosaic();
    }
    
    function calculateMosaic() {
        const sizeSelect = document.getElementById('mosaic-print-size');
        const selectedSize = sizeSelect.value;
        
        // Handle custom size
        if (selectedSize === 'custom') {
            document.getElementById('custom-size-inputs').classList.remove('hidden');
            mosaicSettings.printWidth = parseInt(document.getElementById('custom-width').value) || 150;
            mosaicSettings.printHeight = parseInt(document.getElementById('custom-height').value) || 100;
        } else {
            document.getElementById('custom-size-inputs').classList.add('hidden');
            const preset = PRINT_PRESETS[selectedSize];
            mosaicSettings.printWidth = preset.width;
            mosaicSettings.printHeight = preset.height;
        }
        
        const tileSize = mosaicSettings.tileSize;
        const qualityPreset = QUALITY_PRESETS[mosaicSettings.quality];
        
        // Calculate grid dimensions
        const gridWidth = Math.ceil(mosaicSettings.printWidth / tileSize);
        const gridHeight = Math.ceil(mosaicSettings.printHeight / tileSize);
        const totalFaces = gridWidth * gridHeight;
        
        // Adjust for complexity (more complex images might need more faces for better result)
        let complexityMultiplier = 1;
        if (mosaicSettings.imageComplexity > 80) {
            complexityMultiplier = 1.1; // Suggest 10% more faces for complex images
        }
        
        const recommendedFaces = Math.ceil(totalFaces * complexityMultiplier);
        
        // Calculate view distance
        let viewDistance = '2m';
        if (selectedSize !== 'custom') {
            viewDistance = PRINT_PRESETS[selectedSize].viewDistance;
        } else {
            const maxDim = Math.max(mosaicSettings.printWidth, mosaicSettings.printHeight);
            viewDistance = (maxDim / 75).toFixed(1) + 'm';
        }
        
        // Calculate pricing
        const basePrice = recommendedFaces * 3; // $3 per face base
        const suggestedPrice = Math.round(basePrice / 100) * 100; // Round to nearest $100
        const contributorShare = (suggestedPrice * 0.75 / recommendedFaces).toFixed(2);
        
        // Estimate collection time (assuming 50 faces/day average)
        const daysToCollect = Math.ceil(recommendedFaces / 50);
        let collectionTime;
        if (daysToCollect <= 7) {
            collectionTime = daysToCollect + ' days';
        } else if (daysToCollect <= 30) {
            collectionTime = Math.ceil(daysToCollect / 7) + ' weeks';
        } else {
            collectionTime = Math.ceil(daysToCollect / 30) + ' months';
        }
        
        // Update UI
        document.getElementById('calc-faces-needed').textContent = recommendedFaces.toLocaleString();
        document.getElementById('calc-grid-size').textContent = gridWidth + ' √ó ' + gridHeight + ' tiles';
        document.getElementById('calc-tile-size').textContent = tileSize + ' cm';
        document.getElementById('calc-print-dpi').textContent = qualityPreset.dpi + ' DPI';
        document.getElementById('calc-view-distance').textContent = viewDistance;
        document.getElementById('calc-suggested-price').textContent = '$' + suggestedPrice.toLocaleString();
        document.getElementById('calc-per-contributor').textContent = '$' + contributorShare;
        document.getElementById('calc-collection-time').textContent = collectionTime;
        
        // Store calculated values
        mosaicSettings.calculatedFaces = recommendedFaces;
        mosaicSettings.suggestedPrice = suggestedPrice;
        mosaicSettings.gridWidth = gridWidth;
        mosaicSettings.gridHeight = gridHeight;
    }
    
    async function createMosaicProject() {
        if (!currentGeneratedImage) {
            alert('No image to use');
            return;
        }
        
        const title = document.getElementById('mosaic-project-title').value.trim();
        if (!title) {
            alert('Please enter a project title');
            document.getElementById('mosaic-project-title').focus();
            return;
        }
        
        const description = document.getElementById('mosaic-project-description').value.trim() || 
            'A ' + mosaicSettings.printWidth + '√ó' + mosaicSettings.printHeight + 'cm mosaic artwork requiring ' + mosaicSettings.calculatedFaces + ' contributors.';
        
        addAIMessage('üöÄ Creating mosaic project... Please wait.');
        
        try {
            // Upload the image
            const response = await fetch(currentGeneratedImage);
            const blob = await response.blob();
            
            const fileName = 'mosaic-' + Date.now() + '.png';
            const filePath = 'projects/' + fileName;
            
            const { data: uploadData, error: uploadError } = await supabaseClient.storage
                .from('contributions')
                .upload(filePath, blob, {
                    contentType: 'image/png',
                    upsert: true
                });
            
            let imageUrl = currentGeneratedImage;
            if (uploadData) {
                const { data: urlData } = supabaseClient.storage
                    .from('contributions')
                    .getPublicUrl(filePath);
                if (urlData) {
                    imageUrl = urlData.publicUrl;
                }
            }
            
            // Create project with mosaic settings
            const { data: projectData, error: projectError } = await supabaseClient
                .from('projects')
                .insert({
                    title: title,
                    artist: document.getElementById('ai-signature').value.trim() || 'Y. Husri',
                    description: description,
                    image_url: imageUrl,
                    total_spots: mosaicSettings.calculatedFaces,
                    filled_spots: 0,
                    status: 'open',
                    price: mosaicSettings.suggestedPrice,
                    source: 'AI Generated Mosaic',
                    print_width: mosaicSettings.printWidth,
                    print_height: mosaicSettings.printHeight,
                    tile_size: mosaicSettings.tileSize,
                    grid_width: mosaicSettings.gridWidth,
                    grid_height: mosaicSettings.gridHeight
                })
                .select()
                .single();
            
            if (projectError) throw projectError;
            
            addAIMessage('‚úÖ Mosaic project "<strong class="text-pink-400">' + title + '</strong>" created!<br><br>' +
                'üìê Size: ' + mosaicSettings.printWidth + '√ó' + mosaicSettings.printHeight + 'cm<br>' +
                'üë• Faces needed: ' + mosaicSettings.calculatedFaces.toLocaleString() + '<br>' +
                'üí∞ Price: $' + mosaicSettings.suggestedPrice.toLocaleString() + '<br><br>' +
                'The project is now open for contributions in the Gallery!');
            
            // Hide calculator
            hideMosaicCalculator();
            
            // Clear form
            document.getElementById('mosaic-project-title').value = '';
            document.getElementById('mosaic-project-description').value = '';
            
        } catch (error) {
            console.error('Error creating mosaic project:', error);
            addAIMessage('‚ùå Failed to create project: <strong class="text-pink-400">' + error.message + '</strong>');
        }
    }

    async function useAsProject() {
        if (!currentGeneratedImage) {
            alert('No image to use');
            return;
        }
        
        const title = prompt('Enter project title:', 'New AI Generated Project');
        if (!title) return;
        
        const description = prompt('Enter project description:', 'An original AI-generated artwork created for InfraMint');
        
        const totalSpots = prompt('How many contributor spots?', '5000');
        if (!totalSpots || isNaN(parseInt(totalSpots))) return;
        
        addAIMessage('Creating project... Please wait.');
        
        try {
            const response = await fetch(currentGeneratedImage);
            const blob = await response.blob();
            
            const fileName = 'project-' + Date.now() + '.png';
            const filePath = 'projects/' + fileName;
            
            const { data: uploadData, error: uploadError } = await supabaseClient.storage
                .from('contributions')
                .upload(filePath, blob, {
                    contentType: 'image/png',
                    upsert: true
                });
            
            let imageUrl = currentGeneratedImage;
            if (uploadData) {
                const { data: urlData } = supabaseClient.storage
                    .from('contributions')
                    .getPublicUrl(filePath);
                if (urlData) {
                    imageUrl = urlData.publicUrl;
                }
            }
            
            const { data: projectData, error: projectError } = await supabaseClient
                .from('projects')
                .insert({
                    title: title,
                    artist: document.getElementById('ai-signature').value.trim() || 'InfraMint AI',
                    description: description,
                    image_url: imageUrl,
                    total_spots: parseInt(totalSpots),
                    filled_spots: 0,
                    status: 'open',
                    source: 'AI Generated',
                    source_url: null
                })
                .select()
                .single();
            
            if (projectError) throw projectError;
            
            addAIMessage('‚úÖ Project "<strong class="text-pink-400">' + title + '</strong>" has been created successfully with ' + totalSpots + ' contributor spots!');
            
        }
    }

</script>
</body>
</html>
